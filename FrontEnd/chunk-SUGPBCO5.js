import{a as P,b as Q}from"./chunk-7PXE4S5L.js";import{a as Je}from"./chunk-UOWP4OY2.js";import{a as We}from"./chunk-FAEUQIFQ.js";import{a as Ye,b as ne}from"./chunk-P4PAYY2C.js";import{a as ze,b as Ue,c as He}from"./chunk-WJEX57WX.js";import{a as $e}from"./chunk-K2JQ4OKV.js";import{a as Be,b as qe,c as Xe}from"./chunk-CB4RFODM.js";import{a as O}from"./chunk-KDRCW2VF.js";import{a as L,b as ve}from"./chunk-D35OUFHA.js";import{a as R}from"./chunk-HN2IWLXW.js";import{a as K}from"./chunk-6B6PMKOT.js";import{a as Oe}from"./chunk-CIRWMTLN.js";import{a as J}from"./chunk-LUXURQN6.js";import{g as ge,j as Le}from"./chunk-UD2FEJ4L.js";import{a as ue,b as fe,c as ke,d as be}from"./chunk-MDZA5IL6.js";import"./chunk-XP7WEH62.js";import{C as W,E as V,F as G,J as D,b as I,c as Ne,e as Ve,i as T,l as z,n as M,p as U,q as k,r as Re,u as N,x as H,y as Y}from"./chunk-KKJSUWDN.js";import{e as Ge}from"./chunk-234L6G73.js";import{b as Ae,d as X}from"./chunk-UEKZXHJT.js";import"./chunk-L5AVPIHT.js";import"./chunk-6KZCN3UQ.js";import{a as he}from"./chunk-BP4Z4LAT.js";import"./chunk-LYM3MK3M.js";import{Ba as $,Q as j,R as A,ba as Ie,wa as w}from"./chunk-H26SRIJU.js";import{Ac as B,Cb as g,Dc as je,Eb as x,Ec as C,Gc as q,Hc as h,Lb as oe,Mb as m,Nb as de,Ob as ye,Qa as l,Sb as Pe,Tb as Ee,Ub as Fe,Vb as S,Wb as _,Zb as ce,_ as se,cc as ie,dc as re,fc as Se,gb as v,ha as d,ib as s,ma as y,pb as ee,q as De,tb as r,ub as i,vb as u,wa as E,wb as te,xa as F,xb as ae,yc as pe,zb as me,zc as Me}from"./chunk-IEDNLM77.js";import{a as Z,b as Te,d as we}from"./chunk-NEB6MB4Y.js";var at={validation:!1},Ke=(()=>{let n=class n{constructor(){this.dialogRef=d(ue),this._matData=d(fe),this.fb=d(W),this.pagoTrabajadoresService=d(P),this.estadosDatosService=d(R),this.swalService=d(J)}ngOnInit(){this.createForm();let t=this._matData.data;console.log(t),this.form.patchValue({valorRecibido:parseFloat(t.total.replace(/[\$,]/g,""))})}onCambioEstado(){if(this.form.valid){let a=this._matData.data,t=this.form.getRawValue(),{valorRecibido:p}=t,b=we(t,["valorRecibido"]),f=Z({id:a.id,idEstadoCobroPago:Q.PAGADOS,valorRecibido:parseFloat(p)},b);this.pagoTrabajadoresService.putPagoTrabajadorIndividual(f).subscribe(le=>{this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.closeDialog()},le=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})})}}closeDialog(){this.dialogRef.close()}createForm(){this.form=this.fb.group({comprobante:["",M.required],valorRecibido:[""],observacion:[""]})}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=y({type:n,selectors:[["app-dialog-estado-masivo"]],standalone:!0,features:[S([{provide:A,useClass:O},{provide:j,useValue:"en-GB"},C,h,L(at)]),_],decls:30,vars:8,consts:[[1,"relative","flex","h-full","w-full","flex-col"],[1,"flex","flex-auto","flex-col","items-center","pb-6","sm:flex-row","sm:items-start","sm:pb-8"],[1,"flex","h-10","w-10","flex-0","items-center","justify-center","rounded-full","sm:mr-4","bg-blue-100","text-blue-600","dark:bg-blue-600","dark:text-blue-50"],[3,"svgIcon"],[1,"flex","flex-col","items-center","space-y-1","text-center","sm:mt-0","sm:items-start","sm:pr-8","sm:text-left"],[1,"text-xl","font-medium","leading-6"],[1,"text-secondary"],[1,"mt-8",3,"formGroup"],[1,"mt-4","flex","flex-col","items-center","space-y-1","text-center","sm:mt-0","sm:items-start","sm:text-left"],["floatLabel","always",1,"w-full","min-w-90"],["matInput","","placeholder","Comprobante",3,"formControlName"],["matInput","","placeholder","Valor recibido","mask","separator.2","thousandSeparator",",","decimalMarker",".",3,"formControlName"],["floatLabel","always",1,"w-full"],["matInput","","placeholder","Observaciones",3,"formControlName"],[1,"flex","items-center","justify-center","space-x-3","bg-gray-50","py-4","dark:bg-black","dark:bg-opacity-10","sm:justify-end"],["mat-stroked-button","",1,"sm:w-auto","w-full","bg-crediorange-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"matDialogClose"],["mat-flat-button","",1,"sm:w-auto","w-full","bg-crediblue-50","hover:bg-crediblue-100","text-white","font-semibold","py-2","px-4","rounded-lg","transition","duration-200",3,"click","color","matDialogClose"]],template:function(a,e){a&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),u(3,"mat-icon",3),i(),r(4,"div",4)(5,"div",5),m(6," Confirmacion "),i(),r(7,"div",6),m(8," \xBFEst\xE1 seguro de cambiar el estado?. "),i()()(),r(9,"form",7)(10,"div",8)(11,"mat-form-field",9)(12,"mat-label"),m(13,"N\xFAmero de comprobante"),i(),u(14,"input",10),i()(),r(15,"div",8)(16,"mat-form-field",9)(17,"mat-label"),m(18,"Valor recibido"),i(),u(19,"input",11),i()(),r(20,"div",8)(21,"mat-form-field",12)(22,"mat-label"),m(23,"Observaciones"),i(),u(24,"textarea",13),i()()(),r(25,"div",14)(26,"button",15),m(27," Cancelar "),i(),r(28,"button",16),g("click",function(){return e.onCambioEstado()}),m(29," Confirmar "),i()()()),a&2&&(l(3),s("svgIcon","heroicons_solid:question-mark-circle"),l(6),s("formGroup",e.form),l(5),s("formControlName","comprobante"),l(5),s("formControlName","valorRecibido"),l(5),s("formControlName","observacion"),l(2),s("matDialogClose","cancelled"),l(2),s("color","primary")("matDialogClose","confirmed"))},dependencies:[V,N,z,U,k,w,T,$,D,I,ve,G,H,Y,be]});let o=n;return o})();var ot=(o,n)=>({"bg-crediblue-50":o,"bg-credigray-100":n});function it(o,n){o&1&&(r(0,"span"),m(1,"Error el abono no puede ser mayor igual al total, favor realice el pago por cambio de estado."),i())}function rt(o,n){if(o&1&&(r(0,"mat-error"),v(1,it,2,0,"span",12),i()),o&2){let c,t=x();l(),s("ngIf",(c=t.form.get("valor").errors)==null?null:c.maxAmount)}}var nt={validation:!1},Qe=(()=>{let n=class n{constructor(){this.dialogRef=d(ue),this._matData=d(fe),this.fb=d(W),this.estadosDatosService=d(R),this.pagoTrabajadoresService=d(P),this.swalService=d(J)}ngOnInit(){this.createForm();let t=this._matData.data,a=typeof t.total=="string"?parseFloat(t.total.replace(/[\$,]/g,"")):typeof t.total=="number"?t.total:0,e=typeof t.totalAbono=="string"?parseFloat(t.totalAbono.replace(/[\$,]/g,"")):typeof t.totalAbono=="number"?t.totalAbono:0;this.form.get("valor").setValidators([lt(a,e),M.required]),this.form.updateValueAndValidity()}closeDialog(){this.dialogRef.close()}createForm(){this.form=this.fb.group({comprobante:["",M.required],valor:["",M.required],idPagoTrabajador:[""]})}onAbono(){if(this.form.valid){let t=this._matData.data,a=this.form.getRawValue(),{valor:e,comprobante:p}=a,b={idPagoTrabajador:t.id,valor:parseFloat(e),comprobante:p};this.pagoTrabajadoresService.pagoTrabajadoresAbono(b).subscribe(f=>{this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.closeDialog()},f=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})})}}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=y({type:n,selectors:[["app-dialog-abonos-masivos"]],standalone:!0,features:[S([{provide:A,useClass:O},{provide:j,useValue:"en-GB"},C,h,L(nt)]),_],decls:26,vars:13,consts:[[1,"relative","flex","h-full","w-full","flex-col"],[1,"flex","flex-auto","flex-col","items-center","pb-6","sm:flex-row","sm:items-start","sm:pb-8"],[1,"flex","h-10","w-10","flex-0","items-center","justify-center","rounded-full","sm:mr-4","bg-blue-100","text-blue-600","dark:bg-blue-600","dark:text-blue-50"],[3,"svgIcon"],[1,"flex","flex-col","items-center","space-y-1","text-center","sm:mt-0","sm:items-start","sm:pr-8","sm:text-left"],[1,"text-xl","font-medium","leading-6"],[1,"text-secondary"],[1,"mt-8",3,"formGroup"],[1,"mt-4","flex","flex-col","items-center","space-y-1","text-center","sm:mt-0","sm:items-start","sm:text-left"],["floatLabel","always",1,"w-full","min-w-90"],["matInput","","placeholder","Comprobante",3,"formControlName"],["matInput","","placeholder","Valor recibido","mask","separator.2","thousandSeparator",",","decimalMarker",".",3,"formControlName"],[4,"ngIf"],[1,"flex","items-center","justify-center","space-x-3","bg-gray-50","py-4","dark:bg-black","dark:bg-opacity-10","sm:justify-end"],["mat-stroked-button","",1,"sm:w-auto","w-full","bg-crediorange-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"matDialogClose"],["mat-flat-button","",1,"sm:w-auto","w-full","hover:bg-crediblue-100","text-white","font-semibold","py-2","px-4","rounded-lg","transition","duration-200",3,"click","color","matDialogClose","ngClass","disabled"]],template:function(a,e){a&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),u(3,"mat-icon",3),i(),r(4,"div",4)(5,"div",5),m(6," Confirmacion "),i(),r(7,"div",6),m(8," \xBFEst\xE1 seguro de realizar abono?. "),i()()(),r(9,"form",7)(10,"div",8)(11,"mat-form-field",9)(12,"mat-label"),m(13,"N\xFAmero de comprobante"),i(),u(14,"input",10),i()(),r(15,"div",8)(16,"mat-form-field",9)(17,"mat-label"),m(18,"Valor abono"),i(),u(19,"input",11),v(20,rt,2,1,"mat-error",12),i()()(),r(21,"div",13)(22,"button",14),m(23," Cancelar "),i(),r(24,"button",15),g("click",function(){return e.onAbono()}),m(25," Guardar "),i()()()),a&2&&(l(3),s("svgIcon","heroicons_solid:question-mark-circle"),l(6),s("formGroup",e.form),l(5),s("formControlName","comprobante"),l(5),s("formControlName","valor"),l(),s("ngIf",e.form.get("valor").dirty||e.form.get("valor").touched),l(2),s("matDialogClose","cancelled"),l(2),s("color","primary")("matDialogClose","confirmed")("ngClass",ce(10,ot,e.form.valid,e.form.invalid))("disabled",e.form.invalid))},dependencies:[V,N,z,U,k,w,T,$,D,I,ve,G,H,Y,be,Ne,B,pe]});let o=n;return o})();function lt(o,n){return c=>{let t=c.value,a=o-n;return t>=a?{maxAmount:{maxValue:a,actual:t}}:null}}function st(o,n){if(o&1&&(te(0),u(1,"app-custom-table",19),ae()),o&2){let c=x(2);l(),s("columns",c.columns)("displayedColumns",c.columns)("columnPropertyMap",c.columnPropertyMap)("data",c.data)("buttons",c.buttons)("searchTerm",c.searchTerm)}}function mt(o,n){o&1&&(r(0,"div",20)(1,"div",21)(2,"fuse-alert",22)(3,"span",23),m(4,"Informaci\xF3n"),i(),m(5," No hay pagos pendientes hasta el momento. "),i()()()),o&2&&(l(2),s("type","info")("appearance","outline"))}function dt(o,n){if(o&1&&v(0,st,2,6,"ng-container",18)(1,mt,6,2,"ng-template",null,1,Se),o&2){let c=oe(2),t=x();s("ngIf",t.data.length)("ngIfElse",c)}}function ct(o,n){if(o&1&&(te(0),u(1,"app-custom-table",19),ae()),o&2){let c=x(2);l(),s("columns",c.columns)("displayedColumns",c.columns)("columnPropertyMap",c.columnPropertyMap)("data",c.data)("buttons",c.buttonsPagado)("searchTerm",c.searchTerm)}}function pt(o,n){o&1&&(r(0,"div",20)(1,"div",21)(2,"fuse-alert",22)(3,"span",23),m(4,"Informaci\xF3n"),i(),m(5," No hay pagos hasta el momento. "),i()()()),o&2&&(l(2),s("type","info")("appearance","outline"))}function ut(o,n){if(o&1&&v(0,ct,2,6,"ng-container",18)(1,pt,6,2,"ng-template",null,1,Se),o&2){let c=oe(2),t=x();s("ngIf",t.data.length)("ngIfElse",c)}}var Ze=(()=>{let n=class n{constructor(){this.datePipe=d(C),this.searchTerm="",this.currencyPipe=d(h),this.pagoTrabajadorService=d(P),this._matDialog=d(ke),this.estadoDatosService=d(R),this.router=d(X),this.selectedTab=Q.PENDIENTES,this.data=[],this.columns=["Fecha de liquidaci\xF3n","Empresa","Valor","Estado"],this.columnPropertyMap={"Fecha de liquidaci\xF3n":"fechaCreacion",Empresa:"nombreSubempresa",Valor:"total",Estado:"nombreEstadoCobro"},this.buttons=[{label:"Ver",icon:"visibility",action:t=>{console.log("Editing",t),this.router.navigate(["/pages/gestion-cobros/trabajadores/pago/",t.id])}},{label:"Cambiar estado",icon:"published_with_changes",action:t=>{console.log("View",t),this.selectedData=t,this.onCambioEstado()}},{label:"Abonos",icon:"request_quote",action:t=>{console.log("View",t),this.selectedData=t,this.onAbono()}},{label:"Comprobante",icon:"document_scanner",action:t=>{console.log("Editing",t),this.router.navigate(["/pages/gestion-cobros/trabajador/individual/",t.id])}}],this.buttonsPagado=[{label:"Ver",icon:"visibility",action:t=>{console.log("Editing",t),this.router.navigate(["/pages/gestion-cobros/trabajadores/pago/",t.id])}},{label:"Comprobante",icon:"document_scanner",action:t=>{console.log("Editing",t),this.router.navigate(["/pages/gestion-cobros/trabajador/individual/",t.id])}}],this.tabChanged=t=>{this.tabIndex=t.index,this.selectedTab=t.index==0?Q.PENDIENTES:Q.PAGADOS,this.getPagoTrabajadores(this.selectedTab)}}onCambioEstado(){this._matDialog.open(Ke,{autoFocus:!1,data:{edit:!0,data:this.selectedData},width:"30%",disableClose:!0,panelClass:"custom-dialog-container"})}onAbono(){this._matDialog.open(Qe,{autoFocus:!1,data:{edit:!0,data:this.selectedData},width:"30%",disableClose:!0,panelClass:"custom-dialog-container"})}ngOnDestroy(){}ngOnInit(){this.getPagoTrabajadores(this.selectedTab),this.listenGrid()}onNew(){this.router.navigate(["/pages/gestion-cobros/trabajadores/pago"])}getPagoTrabajadores(t){this.pagoTrabajadorService.getPagosTrabajadores(t).pipe(se(a=>(a.data.forEach(e=>{e.fechaCreacion=this.datePipe.transform(e.fechaCreacion,"dd/MM/yyyy"),e.total=e.total-e.totalAbono,e.total=this.currencyPipe.transform(e.total,"USD","symbol","1.2-2")}),a))).subscribe(a=>{this.data=a.data})}onSearch(t){let a=t.target;this.searchTerm=a.value.trim().toLowerCase()}listenGrid(){this.estadoDatosService.stateGrid.asObservable().subscribe(a=>{a&&this.getPagoTrabajadores(this.selectedTab)})}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=y({type:n,selectors:[["app-grid-pago-trabajadores"]],standalone:!0,features:[S([C,h]),_],decls:20,vars:8,consts:[["tabGroup",""],["noData",""],[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],["mat-flat-button","",1,"mt-2","w-full","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold","sm:ml-4","sm:mt-0","sm:w-auto",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],["mat-stretch-tabs","false",1,"sm:px-2",3,"selectedIndexChange","selectedTabChange","animationDuration","selectedIndex"],["label","Pendientes"],["matTabContent",""],["label","Pagados"],[4,"ngIf","ngIfElse"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons","searchTerm"],[1,"inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"inline-block","p-4","sm:p-2","print:p-0","w-full"],[3,"type","appearance"],["fuseAlertTitle",""]],template:function(a,e){if(a&1){let p=me();r(0,"div",2)(1,"div",3)(2,"div",4),m(3,"Registro de Cobro Masivo"),i(),r(4,"div",5)(5,"mat-form-field",6),u(6,"mat-icon",7),r(7,"input",8),g("input",function(f){return E(p),F(e.onSearch(f))}),i()(),r(8,"button",9),g("click",function(){return E(p),F(e.onNew())}),u(9,"mat-icon",10),r(10,"span",11),m(11,"Registrar"),i()()()(),r(12,"div",12)(13,"div",13)(14,"mat-tab-group",14,0),Fe("selectedIndexChange",function(f){return E(p),Ee(e.tabIndex,f)||(e.tabIndex=f),F(f)}),g("selectedTabChange",function(f){return E(p),F(e.tabChanged(f))}),r(16,"mat-tab",15),v(17,dt,3,2,"ng-template",16),i(),r(18,"mat-tab",17),v(19,ut,3,2,"ng-template",16),i()()()()()}a&2&&(l(5),s("subscriptSizing","dynamic"),l(),s("svgIcon","heroicons_solid:magnifying-glass"),l(),s("autocomplete","off")("placeholder","Buscar"),l(),s("color","primary"),l(),s("svgIcon","heroicons_outline:plus"),l(5),s("animationDuration","500"),Pe("selectedIndex",e.tabIndex))},dependencies:[K,w,T,$,D,he,Ue,ze,He,B]});let o=n;return o})();var ft=(o,n)=>({"bg-credigray-100":o,"bg-green-600":n});function bt(o,n){if(o&1&&(r(0,"mat-option",23),m(1),i()),o&2){let c=n.$implicit;s("value",c.id),l(),de(c.razonSocial)}}function gt(o,n){if(o&1&&(te(0),v(1,bt,2,2,"mat-option",22),ae()),o&2){let c=n.ngIf;l(),s("ngForOf",c.data)}}function ht(o,n){if(o&1&&(r(0,"div",18)(1,"div",24),u(2,"app-custom-table",25),i()()),o&2){let c=x();l(2),s("columns",c.columns)("displayedColumns",c.columns)("columnPropertyMap",c.columnPropertyMap)("data",c.data)("buttons",c.buttons)}}function vt(o,n){if(o&1&&(r(0,"div",19)(1,"div",26)(2,"fuse-alert",27)(3,"span",28),m(4,"Informaci\xF3n"),i(),m(5),i()()()),o&2){let c=x();l(2),s("type","info")("appearance","outline"),l(3),ye(" ",c.message," ")}}function xt(o,n){if(o&1&&(r(0,"span",21),m(1,"Subtotal: "),r(2,"span",29),m(3),ie(4,"currency"),i()()),o&2){let c=x();l(3),de(re(4,1,c.subtotal))}}function Ct(o,n){if(o&1&&(r(0,"span",21),m(1,"Comisiones: "),r(2,"span",29),m(3),ie(4,"currency"),i()()),o&2){let c=x();l(3),de(re(4,1,c.totalComision))}}function yt(o,n){if(o&1&&(r(0,"span",21),m(1,"Total a pagar: "),r(2,"span",29),m(3),ie(4,"currency"),i()()),o&2){let c=x();l(3),ye(" ",re(4,1,c.totalPagar)," ")}}var St={validation:!1},et=(()=>{let n=class n{constructor(){this.fb=d(W),this.empresaClienteService=d($e),this.pagoTrabajadorService=d(P),this.cobroTrabajadorService=d(Je),this.datePipe=d(C),this.swalService=d(J),this.estadosDatosService=d(R),this.fuseService=d(ge),this.currencyPipe=d(h),this.decimalPipe=d(q),this.router=d(X),this.empresa$=this.empresaClienteService.getEmpresasClientes(),this.tipoPago$=this.pagoTrabajadorService.tipoPagoTrabajadores().subscribe(t=>{this.idTipoPagoTrabajador=t.data[0].id}),this.data=[],this.fechaActual=new Date,this.aesEncriptService=d(Ge),this.columns=["Identificaci\xF3n","Nombres Apellidos","Valor pendiente"],this.columnPropertyMap={Identificaci\u00F3n:"documentoTrabajador","Nombres Apellidos":"nombreCompleto","Valor pendiente":"valorPendiente"},this.buttons=[{label:"Eliminar",icon:"delete",action:this.deleteItem.bind(this),iconColor:"text-crediorange-100"}]}createForm(){this.form=this.fb.group({fechaFinal:["",M.required],idSubEmpresa:["",M.required],idTipoPagoTrabajador:[""]})}ngOnInit(){this.createForm()}closeDialog(){this.router.navigate(["/pages/gestion-cobros/trabajadores"])}onGet(){if(this.form.valid){let{fechaFinal:t,idSubEmpresa:a}=this.form.getRawValue();console.log(t);let p={fechaFinallData:this.datePipe.transform(t,"yyyy-MM-dd"),idSubEmpresa:a};this.getAllPagoTrabajador(p)}}onSave(){let{fechaFinal:t,idSubEmpresa:a,idTipoPagoTrabajador:e}=this.form.getRawValue(),b={fechaFinal:this.datePipe.transform(t,"yyyy-MM-dd"),idSubEmpresa:a},f=[];f=this.data.map(Ce=>({idCobroTrabajador:Ce.id}));let le=Te(Z({},b),{detallePagoTrabajador:f});console.log(le),this.fuseService.open(Z({},Le)).afterClosed().subscribe(Ce=>{Ce==="confirmed"&&this.postSave(le)})}getAllPagoTrabajador(t){this.cobroTrabajadorService.getCobroTrabajadores(t).pipe(De(a=>(this.subtotal=0,this.totalComision=0,this.totalPagar=0,a&&Array.isArray(a.data)?a.data.forEach(e=>{e.montoCuota&&(e.montoCuota=this.aesEncriptService.decrypt(e.montoCuota)),e.valorPendiente&&(e.valorPendiente=this.aesEncriptService.decrypt(e.valorPendiente)),e.montoCuota=this.currencyPipe.transform(e.montoCuota,"USD","symbol","1.2-2"),e.pagar=this.currencyPipe.transform(e.pagar,"USD","symbol","1.2-2"),e.valorPendiente=this.currencyPipe.transform(e.valorPendiente,"USD","symbol","1.2-2"),e.fechaCobro=this.datePipe.transform(e.fechaCobro,"dd/MM/yyyy"),this.totalPagar+=parseFloat(e.montoCuota.replace(/[^0-9.-]+/g,""))}):this.data=[],a))).subscribe(a=>{a&&Array.isArray(a.data)?this.data=a.data:(this.data=[],this.message=a.msg)})}postSave(t){this.pagoTrabajadorService.postPagosTrabajadores(t).subscribe(a=>{this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.estadosDatosService.stateGrid.next(!0),this.closeDialog()},a=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})})}deleteItem(t){let a=this.data.findIndex(e=>e===t);if(a>-1){let e=parseFloat(t.montoCuota.replace(/[^0-9.-]+/g,""));this.totalPagar-=isNaN(e)?0:e,this.data.splice(a,1),this.data=[...this.data]}}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=y({type:n,selectors:[["app-form-pago-trabajadores"]],standalone:!0,features:[S([{provide:A,useClass:O},{provide:j,useValue:"en-GB"},C,h,q,L(St)]),_],decls:39,vars:19,consts:[["finalPicker",""],[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","pl-8"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","sm:flex-row","md:px-8"],[1,"mt-6","w-full","shrink-0","sm:mt-0","sm:space-x-2","lg:w-full"],[1,"mt-8",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","gap-2.5"],["floatLabel","always",1,"w-full","min-w-90"],["matInput","","placeholder","dd/mm/yyyy",3,"matDatepicker","formControlName"],["matIconSuffix","",3,"for"],["placeholder","Empresa",3,"formControlName"],[4,"ngIf"],[1,"relative","border","border-gray-300","rounded-lg"],[1,"absolute","-top-3","left-4","bg-white","px-2","text-gray-500","font-semibold"],[1,"flex","flex-wrap","justify-end","gap-2.5","sm:mb-4","pr-2"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"lg:w-auto","w-full","sm:mt-6","transition","duration-200","text-white","font-semibold","rounded-lg","md:w-auto",3,"click","ngClass","disabled"],[1,"flex","flex-auto","overflow-hidden"],[1,"inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"flex","flex-col","gap-4","justify-end","sm:flex-row"],[1,"sm:pr-4","text-gray-600","font-bold","text-right"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:p-4","sm:mb-10","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons"],[1,"inline-block","p-4","sm:p-8","print:p-0","w-full"],[3,"type","appearance"],["fuseAlertTitle",""],[1,"text-gray-800"]],template:function(a,e){if(a&1){let p=me();r(0,"div",1)(1,"div",2),m(2," Cobro Masivo "),i(),r(3,"div",3)(4,"div",4)(5,"form",5)(6,"div",6)(7,"mat-form-field",7)(8,"mat-label"),m(9,"Fecha de corte"),i(),u(10,"input",8)(11,"mat-datepicker-toggle",9)(12,"mat-datepicker",null,0),i(),r(14,"mat-form-field",7)(15,"mat-label"),m(16,"Empresa"),i(),r(17,"mat-select",10),v(18,gt,2,1,"ng-container",11),ie(19,"async"),i()()(),r(20,"div",12)(21,"div",13),m(22," Opciones "),i(),r(23,"div",14)(24,"button",15),g("click",function(){return E(p),F(e.closeDialog())}),r(25,"span"),m(26," Atras "),i()(),r(27,"button",16),g("click",function(){return E(p),F(e.onGet())}),r(28,"span"),m(29," Consultar "),i()(),r(30,"button",17),g("click",function(){return E(p),F(e.onSave())}),r(31,"span"),m(32," Regitrar "),i()()()()()()(),v(33,ht,3,5,"div",18)(34,vt,6,3,"div",19),r(35,"div",20),v(36,xt,5,3,"span",21)(37,Ct,5,3,"span",21)(38,yt,5,3,"span",21),i()()}if(a&2){let p=oe(13);l(5),s("formGroup",e.form),l(5),s("matDatepicker",p)("formControlName","fechaFinal"),l(),s("for",p),l(6),s("formControlName","idSubEmpresa"),l(),s("ngIf",re(19,14,e.empresa$)),l(6),s("color","primary"),l(3),s("color","primary"),l(3),s("ngClass",ce(16,ft,e.data.length==0,e.data.length>0))("disabled",e.data.length==0),l(3),ee(e.data.length?33:e.message?34:-1),l(3),ee(e.subtotal?36:-1),l(),ee(e.totalComision?37:-1),l(),ee(e.totalPagar?38:-1)}},dependencies:[je,h,K,V,N,z,U,k,he,w,Be,qe,Xe,T,D,I,Ie,Oe,Ve,Me,B,G,H,Y,pe]});let o=n;return o})();var _t={validation:!1},tt=(()=>{let n=class n{constructor(){this.fuseService=d(ge),this.currencyPipe=d(h),this.decimalPipe=d(q),this.router=d(X),this.activatedRoute=d(Ae),this.datePipe=d(C),this.pagoTrabajadorService=d(P),this.data=[],this.form={fechaCreacion:"",fechaFinal:"",fechaIncial:"",nombreSubempresa:"",total:""},this.columns=["Identificaci\xF3n","Nombres Apellidos","Valor cobro"],this.columnPropertyMap={Identificaci\u00F3n:"documentoTrabajador","Nombres Apellidos":"nombreCompleto","Valor cobro":"valorPago"}}ngOnDestroy(){this.subscription$.unsubscribe()}ngOnInit(){this.id=this.activatedRoute.snapshot.paramMap.get("id"),this.getTrabajador(this.id)}getTrabajador(t){this.subscription$=this.pagoTrabajadorService.getPagosTrabajador(t).pipe(se(a=>(a.data.detallePagoTrabajador?.forEach(e=>{e.fechaCobro=this.datePipe.transform(e.fechaCobro,"dd/MM/yyyy"),e.valorPago=this.currencyPipe.transform(e.valorPago,"USD","symbol","1.2-2")}),a))).subscribe(a=>{console.log("Si entra"),this.data=a.data.detallePagoTrabajador,this.form.fechaCreacion=this.datePipe.transform(a.data.fechaCreacion,"dd/MM/YYYY"),this.form.fechaFinal=a.data.fechaFinal,this.form.nombreSubempresa=a.data.nombreSubempresa,this.form.total=this.currencyPipe.transform(a.data.total,"USD","symbol","1.2-2"),this.exportData=a.data})}exportToExcel(){let t=[["Detalle cobro trabajadores"],["Empresa:",this.exportData.nombreSubempresa],["Fecha de liquidaci\xF3n:",this.exportData.fechaFinal],["Total:",this.exportData.total]],a=this.exportData.detallePagoTrabajador.map(f=>({Identificaci\u00F3n:f.documentoTrabajador,"Nombre completo":f.nombreCompleto,Valor:We(f.valorPago)})),e=ne.aoa_to_sheet(t),p=t.length+2;ne.sheet_add_json(e,a,{origin:`A${p}`,skipHeader:!1}),e["!merges"]=[{s:{r:0,c:0},e:{r:0,c:2}}];let b=ne.book_new();ne.book_append_sheet(b,e,`DetallePago${this.exportData.fechaFinal}`),Ye(b,`DetallePago${this.exportData.fechaFinal}.xlsx`)}closeDialog(){this.router.navigate(["/pages/gestion-cobros/trabajadores"])}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=y({type:n,selectors:[["app-form-view-pago-trabajadores"]],standalone:!0,features:[S([{provide:A,useClass:O},{provide:j,useValue:"en-GB"},C,h,q,L(_t)]),_],decls:32,vars:8,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"sm:ml-8","mt-8","text-3xl","font-semibold","leading-tight","tracking-tight"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","sm:flex-row","md:px-8"],[1,"mt-6","w-full","shrink-0","sm:mt-0","sm:space-x-2","lg:w-full"],[1,"mt-8"],[1,"flex","flex-col","sm:flex-row","gap-2.5"],["floatLabel","always",1,"w-full","min-w-90"],["matInput","","placeholder","Empresa","readonly","",3,"value"],[1,"relative","p-2","border","border-gray-300","rounded-lg"],[1,"absolute","-top-3","left-4","bg-white","px-2","text-gray-500","font-semibold"],[1,"flex","flex-wrap","justify-end","gap-2.5","sm:mb-4"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"lg:w-auto","w-full","sm:mt-6","bg-green-600","transition","duration-200","text-white","font-semibold","rounded-lg","md:w-auto",3,"click"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:p-4","sm:mb-10","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data"]],template:function(a,e){a&1&&(r(0,"div",0)(1,"div",1),m(2," Detalle cobro trabajadores "),i(),r(3,"div",2)(4,"div",3)(5,"form",4)(6,"div",5)(7,"mat-form-field",6)(8,"mat-label"),m(9,"Empresa"),i(),u(10,"input",7),i(),r(11,"mat-form-field",6)(12,"mat-label"),m(13,"Fecha de liquidaci\xF3n"),i(),u(14,"input",7),i(),r(15,"mat-form-field",6)(16,"mat-label"),m(17,"Total"),i(),u(18,"input",7),i()(),r(19,"div",8)(20,"div",9),m(21," Opciones "),i(),r(22,"div",10)(23,"button",11),g("click",function(){return e.closeDialog()}),r(24,"span"),m(25," Atras "),i()(),r(26,"button",12),g("click",function(){return e.exportToExcel()}),r(27,"span"),m(28," Descargar "),i()()()()()()(),r(29,"div",13)(30,"div",14),u(31,"app-custom-table",15),i()()()),a&2&&(l(10),s("value",e.form.nombreSubempresa),l(4),s("value",e.form.fechaCreacion),l(4),s("value",e.form.total),l(5),s("color","primary"),l(8),s("columns",e.columns)("displayedColumns",e.columns)("columnPropertyMap",e.columnPropertyMap)("data",e.data))},dependencies:[K,V,N,k,Re,w,T,D,I,G]});let o=n;return o})();var vo=[{path:"",component:Ze},{path:"pago",component:et},{path:"pago/:id",component:tt}];export{vo as default};
