import{a as P}from"./chunk-RF3LTEL7.js";import{a as M}from"./chunk-5WR2EL64.js";import{a as de,b as pe,c as ue}from"./chunk-YP3OYDJU.js";import{a as fe}from"./chunk-M6JKQUTX.js";import{a as me,b as ce}from"./chunk-QDHNBSMD.js";import{a as ve}from"./chunk-OFI6PGZL.js";import{a as le}from"./chunk-LNQSU7IH.js";import{b as V}from"./chunk-YHNXG437.js";import{a as w}from"./chunk-VOLXTRGQ.js";import{a as he}from"./chunk-6IEWE3OU.js";import{a as se}from"./chunk-PS6I32XU.js";import"./chunk-JC77WSFI.js";import{g as Y}from"./chunk-2XRFSBL3.js";import{a as q,b as J,c as K}from"./chunk-BF24YLJO.js";import"./chunk-CNRP5CR4.js";import{C as ae,F as ne,J as x,b as Q,e as W,i as C,l as Z,p as ee,q as te,u as re,x as oe,y as ie}from"./chunk-D3YOWHEC.js";import"./chunk-AIQUJILU.js";import{Q as $,R as U,ga as D,la as X}from"./chunk-V35GW63T.js";import"./chunk-AUCKEBH6.js";import"./chunk-UORQGTEL.js";import{Cb as v,Dc as h,Ea as O,Gc as G,Lb as B,Mb as c,Ob as H,Qa as a,Ra as I,Ub as S,Vb as y,ha as l,ib as n,ma as b,q as N,tb as i,ub as o,vb as d,wa as A,xa as R,zb as L}from"./chunk-YBEOGPR3.js";import{a as f,d as z}from"./chunk-NEB6MB4Y.js";var Se={validation:!1},j=(()=>{let m=class m{constructor(){this.fb=l(ae),this.dialogRef=l(q),this.fuseService=l(Y),this.estadosDatosService=l(w),this.toasService=l(le),this.capitalService=l(P),this._matData=l(J),this.swalService=l(ve),this.datePipe=l(h),this.destroyedRef=l(O)}ngOnInit(){this.createForm();let t=this._matData;if(t.edit){let e=t.data;this.getCapital(e.id)}}onSave(){if(this.form.valid)if(this._matData.edit){let e=this.form.getRawValue(),{rubroInversion:s,plazoPagoInversor:u,tasaInteresInversor:k}=e,_=z(e,["rubroInversion","plazoPagoInversor","tasaInteresInversor"]),E=this.datePipe.transform(u,"yyyy-MM-dd"),F=f({rubroInversion:Number(s),plazoPagoInversor:E,tasaInteresInversor:parseFloat(k)},_);this.fuseService.open(f({},V)).afterClosed().subscribe(T=>{T==="confirmed"?this.capitalService.putCapitales(F).pipe(M(this.destroyedRef)).subscribe(g=>{this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro actualizado con exito!",timer:4e3}),this.closeDialog()},g=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al actualizar el registro!",timer:4e3})}):this.closeDialog()})}else{let t=this.form.getRawValue(),{rubroInversion:s,plazoPagoInversor:u,tasaInteresInversor:k}=t,_=z(t,["rubroInversion","plazoPagoInversor","tasaInteresInversor"]),E=this.datePipe.transform(u,"yyyy-MM-dd"),F=f({rubroInversion:Number(s),plazoPagoInversor:E,tasaInteresInversor:parseFloat(k)},_);this.fuseService.open(f({},V)).afterClosed().subscribe(T=>{T==="confirmed"?this.capitalService.postCapitales(F).pipe(M(this.destroyedRef)).subscribe(g=>{console.log(g),this.estadosDatosService.stateGrid.next(!0),this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.closeDialog()},g=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})}):this.closeDialog()})}}getCapital(t){this.capitalService.getCapital(t).pipe(M(this.destroyedRef)).subscribe(e=>{if(e){let r=new Date(e.data.plazoPagoInversor);r.setMinutes(r.getMinutes()+r.getTimezoneOffset());let s={id:e.data.id,nombreInversor:e.data.nombreInversor,rubroInversion:e.data.rubroInversion,detalleInversion:e.data.detalleInversion,tasaInteresInversor:e.data.tasaInteresInversor,plazoPagoInversor:r};this.form.patchValue(s),this.currentValuePorcentaje=f({},this.form.get("tasaInteresInversor"))}})}createForm(){this.form=this.fb.group({id:[null],nombreInversor:[""],rubroInversion:[""],detalleInversion:[""],tasaInteresInversor:[""],plazoPagoInversor:[""]})}closeDialog(){this.dialogRef.close()}};m.\u0275fac=function(e){return new(e||m)},m.\u0275cmp=b({type:m,selectors:[["app-form-capital-inversion"]],standalone:!0,features:[S([{provide:U,useClass:fe},{provide:$,useValue:"en-GB"},h,me(Se)]),y],decls:41,vars:15,consts:[["picker",""],[1,"w-full","sm:bg-card","sm:rounded-2xl","sm:mx-0","mx-auto"],[1,""],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","text-center"],[1,"mt-8",3,"formGroup"],[1,"font-bold","mb-4","text-2xl"],[1,"flex","flex-col","sm:flex-row","gap-2.5"],["floatLabel","always",1,"w-full"],["matInput","","placeholder","Inversor",3,"formControlName"],["matInput","","placeholder","Valor","thousandSeparator",".",3,"formControlName","mask"],["matInput","","placeholder","Tasa de interes inversor","decimalMarker",".",3,"formControlName","thousandSeparator","dropSpecialCharacters","mask"],["matInput","","placeholder","Plazo de pago",3,"matDatepicker","formControlName"],["matIconSuffix","",3,"for"],["matInput","","placeholder","Detalle inversi\xF3n",3,"formControlName"],[1,"flex","flex-wrap","justify-end","gap-2.5"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"]],template:function(e,r){if(e&1){let s=L();i(0,"div",1)(1,"div",2)(2,"div",3),c(3),o(),i(4,"form",4)(5,"div")(6,"p",5),c(7,"Informaci\xF3n de inversor"),o(),i(8,"div",6)(9,"mat-form-field",7)(10,"mat-label"),c(11,"Inversor"),o(),d(12,"input",8),o(),i(13,"mat-form-field",7)(14,"mat-label"),c(15,"Rubro a invertir"),o(),d(16,"input",9),o()(),i(17,"div",6)(18,"mat-form-field",7)(19,"mat-label"),c(20,"Tasa de interes inversor"),o(),d(21,"input",10),o(),i(22,"mat-form-field",7)(23,"mat-label"),c(24,"Plazo pago invesor"),o(),d(25,"input",11)(26,"mat-datepicker-toggle",12)(27,"mat-datepicker",null,0),o()(),i(29,"div",6)(30,"mat-form-field",7)(31,"mat-label"),c(32,"Detalle de la inversi\xF3n"),o(),d(33,"textarea",13),o()()(),i(34,"div",14)(35,"button",15),v("click",function(){return A(s),R(r.closeDialog())}),i(36,"span"),c(37," Cancelar "),o()(),i(38,"button",16),v("click",function(){return A(s),R(r.onSave())}),i(39,"span"),c(40," Guardar "),o()()()()()()}if(e&2){let s=B(28);a(3),H(" ",r._matData.edit?"Actualizar capital":"Agregar capital"," "),a(),n("formGroup",r.form),a(8),n("formControlName","nombreInversor"),a(4),n("formControlName","rubroInversion")("mask","separator.0"),a(5),n("formControlName","tasaInteresInversor")("thousandSeparator","")("dropSpecialCharacters",!0)("mask","separator.6"),a(4),n("matDatepicker",s)("formControlName","plazoPagoInversor"),a(),n("for",s),a(7),n("formControlName","detalleInversion"),a(2),n("color","primary"),a(3),n("color","primary")}},dependencies:[D,C,x,Q,ne,re,Z,ee,te,oe,ie,ce,de,pe,ue,W],styles:[".custom-dialog-container{width:100%}@media (min-width: 1280px){  .custom-dialog-container{width:50%}}"]});let p=m;return p})();var ge=(()=>{let m=class m{constructor(t,e,r){this._matDialog=t,this.estadoDatosService=e,this.capitalService=r,this.datePipe=l(h),this.currencyPipe=l(G),this.searchTerm="",this.data=[],this.columns=["Inversor","Rubro invertido","Rubro disponible","Fecha de retorno","Detalle de inversi\xF3n"],this.columnPropertyMap={Inversor:"nombreInversor","Rubro invertido":"rubroInversion","Rubro disponible":"montoDisponible","Fecha de retorno":"plazoPagoInversor","Detalle de inversi\xF3n":"detalleInversion"},this.buttons=[{label:"Edit",icon:"edit",action:s=>{console.log("Editing",s),this.selectedData=s,this.onEdit()}}]}onNew(){this._matDialog.open(j,{autoFocus:!1,data:{edit:!1},maxHeight:"90vh",disableClose:!0,panelClass:"custom-dialog-container"})}onEdit(){this._matDialog.open(j,{autoFocus:!1,data:{edit:!0,data:this.selectedData},maxHeight:"90vh",disableClose:!0,panelClass:"custom-dialog-container"})}getCapital(){this.subcription$=this.capitalService.getCapitales().pipe(N(t=>(t.data.forEach(e=>{if(e.estado)return e.estado=he.ACTIVO,e}),t)),N(t=>(t.data.forEach(e=>{e.plazoPagoInversor=this.datePipe.transform(e.plazoPagoInversor,"dd/MM/yyyy"),e.rubroInversion=this.currencyPipe.transform(e.rubroInversion,"USD","symbol","1.2-2"),e.montoDisponible=this.currencyPipe.transform(e.montoDisponible,"USD","symbol","1.2-2")}),t))).subscribe(t=>{this.data=t.data})}listenGrid(){this.estadoDatosService.stateGrid.asObservable().subscribe(e=>{e&&this.getCapital()})}onSearch(t){let e=t.target;this.searchTerm=e.value.trim().toLowerCase()}ngOnDestroy(){this.subcription$.unsubscribe()}ngOnInit(){this.getCapital(),this.listenGrid()}};m.\u0275fac=function(e){return new(e||m)(I(K),I(w),I(P))},m.\u0275cmp=b({type:m,selectors:[["app-grid-capital-inversion"]],standalone:!0,features:[S([h,G]),y],decls:15,vars:12,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],["mat-flat-button","",1,"mt-2","w-full","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold","sm:ml-4","sm:mt-0","sm:w-auto",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons","searchTerm"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),c(3,"Capital de Inversi\xF3n"),o(),i(4,"div",3)(5,"mat-form-field",4),d(6,"mat-icon",5),i(7,"input",6),v("input",function(u){return r.onSearch(u)}),o()(),i(8,"button",7),v("click",function(){return r.onNew()}),d(9,"mat-icon",8),i(10,"span",9),c(11,"Agregar"),o()()()(),i(12,"div",10)(13,"div",11),d(14,"app-custom-table",12),o()()()),e&2&&(a(5),n("subscriptSizing","dynamic"),a(),n("svgIcon","heroicons_solid:magnifying-glass"),a(),n("autocomplete","off")("placeholder","Buscar"),a(),n("color","primary"),a(),n("svgIcon","heroicons_outline:plus"),a(5),n("columns",r.columns)("displayedColumns",r.columns)("columnPropertyMap",r.columnPropertyMap)("data",r.data)("buttons",r.buttons)("searchTerm",r.searchTerm))},dependencies:[se,D,C,X,x]});let p=m;return p})();var at=[{path:"",component:ge}];export{at as default};
