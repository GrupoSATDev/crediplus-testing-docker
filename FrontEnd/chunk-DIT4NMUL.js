import{a as Ne}from"./chunk-4LSMNJSH.js";import{a as Ie}from"./chunk-PBZZ24WU.js";import{a as Me,b as Te,c as ke}from"./chunk-LZ3ZEVTF.js";import{a as H}from"./chunk-DTORAJAR.js";import{a as q}from"./chunk-L5756YMZ.js";import{a as M}from"./chunk-3R6HD5RM.js";import{a as Y}from"./chunk-JBDWF4AB.js";import{a as De}from"./chunk-CJO6YW5P.js";import{a as Ee}from"./chunk-ZWBJNS7X.js";import"./chunk-7YBFULQ5.js";import{g as R,j as _e}from"./chunk-QVE5MGEQ.js";import{C as Ae,E as Fe,F as Pe,J as D,b as L,e as he,i as _,l as ye,n as W,p as xe,q as $,r as Se,u as U,x as Ce,y as we}from"./chunk-4PVPKBBG.js";import{b as ue,d as P}from"./chunk-C66ODKJP.js";import{c as ge}from"./chunk-YKJB7XET.js";import"./chunk-FUOI65R5.js";import{a as z}from"./chunk-73F67TFK.js";import"./chunk-XTYNXB3F.js";import{b as be}from"./chunk-2YYUDHRL.js";import{$a as y,Ad as B,Eb as ne,Ec as ce,Fb as s,Gb as G,Hb as C,Ka as r,Md as fe,Ob as w,Pb as A,Sb as le,Xb as k,Yb as I,Z as N,aa as ie,bb as m,fa as Q,fe as E,ga as p,ib as x,ka as S,ke as ve,mb as a,nb as n,ob as u,pb as oe,pc as se,q as te,qb as ae,qc as me,rc as pe,sb as re,ua as j,uc as de,va as V,vb as g,vc as h,xb as v,xc as F,yc as f,zd as O}from"./chunk-ODJKW74N.js";import{a as K,b as ee}from"./chunk-NEB6MB4Y.js";var T=(()=>{let o=class o{constructor(l,e){this._http=l,this.appSettings=e}getAliados(){return this._http.get(`${this.appSettings.pagoAliados.url.base}/Tabla`)}postAliados(l){return this._http.post(this.appSettings.pagoAliados.url.base,l)}getAliado(l){return this._http.get(`${this.appSettings.pagoAliados.url.base}/${l}`)}};o.\u0275fac=function(e){return new(e||o)(Q(ce),Q(be))},o.\u0275prov=ie({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();function Oe(i,o){if(i&1&&(a(0,"div",10)(1,"div",12),u(2,"app-custom-table",13),n()()),i&2){let d=v();r(2),m("columns",d.columns)("displayedColumns",d.columns)("columnPropertyMap",d.columnPropertyMap)("data",d.data)("buttons",d.buttons)("searchTerm",d.searchTerm)}}function Be(i,o){i&1&&(a(0,"div",11)(1,"div",14)(2,"fuse-alert",15)(3,"span",16),s(4,"Informaci\xF3n"),n(),s(5," No hay informaci\xF3n hasta el momento. "),n()()()),i&2&&(r(2),m("type","info")("appearance","outline"))}var je=(()=>{let o=class o{constructor(){this.datePipe=p(h),this.searchTerm="",this.currencyPipe=p(f),this.pagoAliadoService=p(T),this._matDialog=p(ge),this.estadoDatosService=p(Y),this.router=p(P),this.data=[],this.columns=["Creaci\xF3n","Empresa","Total"],this.columnPropertyMap={Creaci\u00F3n:"fechaCreacion",Empresa:"nombreSubempresa",Total:"total"},this.buttons=[{label:"Ver",icon:"visibility",action:l=>{console.log("Editing",l),this.router.navigate(["/pages/gestion-cobros/aliados/detalle/",l.id])}}]}ngOnDestroy(){}ngOnInit(){this.getAliados(),this.listenGrid()}onNew(){this.router.navigate(["/pages/gestion-cobros/aliados/aliado"])}getAliados(){this.pagoAliadoService.getAliados().pipe(N(l=>(l.data.forEach(e=>{e.fechaCreacion=this.datePipe.transform(e.fechaCreacion,"dd/MM/yyyy"),e.total=this.currencyPipe.transform(e.total,"USD","symbol","1.2-2")}),l))).subscribe(l=>{this.data=l.data})}onSearch(l){let e=l.target;this.searchTerm=e.value.trim().toLowerCase()}listenGrid(){this.estadoDatosService.stateGrid.asObservable().subscribe(e=>{e&&this.getAliados()})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=S({type:o,selectors:[["app-grid-aliados"]],standalone:!0,features:[w([h,f]),A],decls:14,vars:7,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","py-8","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],["mat-flat-button","",1,"mt-2","w-full","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold","sm:ml-4","sm:mt-0","sm:w-auto",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons","searchTerm"],[1,"inline-block","p-4","sm:p-2","print:p-0","w-full"],[3,"type","appearance"],["fuseAlertTitle",""]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),s(3,"Pago proveedores"),n(),a(4,"div",3)(5,"mat-form-field",4),u(6,"mat-icon",5),a(7,"input",6),g("input",function(b){return t.onSearch(b)}),n()(),a(8,"button",7),g("click",function(){return t.onNew()}),u(9,"mat-icon",8),a(10,"span",9),s(11,"Pagar"),n()()()(),y(12,Oe,3,6,"div",10)(13,Be,6,2,"div",11),n()),e&2&&(r(5),m("subscriptSizing","dynamic"),r(),m("svgIcon","heroicons_solid:magnifying-glass"),r(),m("autocomplete","off")("placeholder","Buscar"),r(),m("color","primary"),r(),m("svgIcon","heroicons_outline:plus"),r(3),x(t.data.length>0?12:13))},dependencies:[M,_,ve,D,E,z]});let i=o;return i})();var Re=(i,o)=>({"bg-credigray-100":i,"bg-green-600":o});function $e(i,o){if(i&1&&(a(0,"mat-option",23),s(1),n()),i&2){let d=o.$implicit;m("value",d.id),r(),G(d.razonSocial)}}function Ue(i,o){if(i&1&&(oe(0),y(1,$e,2,2,"mat-option",22),ae()),i&2){let d=o.ngIf;r(),m("ngForOf",d.data)}}function ze(i,o){if(i&1&&(a(0,"div",18)(1,"div",24),u(2,"app-custom-table",25),n()()),i&2){let d=v();r(2),m("columns",d.columns)("displayedColumns",d.columns)("columnPropertyMap",d.columnPropertyMap)("data",d.data)}}function Ye(i,o){if(i&1&&(a(0,"div",19)(1,"div",26)(2,"fuse-alert",27)(3,"span",28),s(4,"Informaci\xF3n"),n(),s(5),n()()()),i&2){let d=v();r(2),m("type","info")("appearance","outline"),r(3),C(" ",d.message," ")}}function qe(i,o){if(i&1&&(a(0,"span",21),s(1,"Subtotal: "),a(2,"span",29),s(3),k(4,"currency"),n()()),i&2){let d=v();r(3),G(I(4,1,d.subtotal))}}function He(i,o){if(i&1&&(a(0,"span",21),s(1,"Comisiones: "),a(2,"span",29),s(3),k(4,"currency"),n()()),i&2){let d=v();r(3),G(I(4,1,d.totalComision))}}function Je(i,o){if(i&1&&(a(0,"span",21),s(1,"Total a pagar: "),a(2,"span",29),s(3),k(4,"currency"),n()()),i&2){let d=v();r(3),C(" ",I(4,1,d.totalPagar)," ")}}var Ke={validation:!1},Ve=(()=>{let o=class o{constructor(){this.fb=p(Ae),this.empresaClienteService=p(Ie),this.detalleConsumoService=p(Ne),this.pagoAliadoService=p(T),this.datePipe=p(h),this.swalService=p(Ee),this.estadosDatosService=p(Y),this.fuseService=p(R),this.currencyPipe=p(f),this.decimalPipe=p(F),this.router=p(P),this.empresa$=this.empresaClienteService.getEmpresasClientes(),this.data=[],this.columns=["N\xFAmero de factura","Porcentaje","Valor","Comision","Total a Pagar"],this.columnPropertyMap={"N\xFAmero de factura":"numeroFactura",Porcentaje:"porcentajeSubEmpresa",Valor:"montoConsumo",Comision:"comision","Total a Pagar":"pagar"}}createForm(){this.form=this.fb.group({fechaFinal:["",W.required],idSubEmpresa:["",W.required]})}ngOnInit(){this.createForm()}closeDialog(){this.router.navigate(["/pages/gestion-cobros/aliados"])}onGet(){if(this.form.valid){let{fechaFinal:l,idSubEmpresa:e}=this.form.getRawValue();console.log(l);let c={fechaFinallData:this.datePipe.transform(l,"yyyy-MM-dd"),idSubEmpresa:e};this.getAllPago(c)}}onSave(){let{fechaFinal:l,idSubEmpresa:e}=this.form.getRawValue(),c={fechaFinal:this.datePipe.transform(l,"yyyy-MM-dd"),idSubEmpresa:e},b=[];b=this.data.map(J=>({idDetalleConsumo:J.id}));let Z=ee(K({},c),{detallePagoAliado:b});console.log(Z),this.fuseService.open(K({},_e)).afterClosed().subscribe(J=>{J==="confirmed"&&this.postSave(Z)})}getAllPago(l){this.detalleConsumoService.getPagosAliados(l).pipe(te(e=>(this.subtotal=0,this.totalComision=0,this.totalPagar=0,e&&Array.isArray(e.data)?e.data.forEach(t=>{t.comision=t.montoConsumo*t.porcentajeSubEmpresa/100,t.pagar=t.montoConsumo-t.comision,t.montoConsumo=this.currencyPipe.transform(t.montoConsumo,"USD","symbol","1.2-2"),t.comision=this.currencyPipe.transform(t.comision,"USD","symbol","1.2-2"),t.pagar=this.currencyPipe.transform(t.pagar,"USD","symbol","1.2-2"),t.porcentajeSubEmpresa=this.decimalPipe.transform(t.porcentajeSubEmpresa,"1.2-2")+"%",this.subtotal+=parseFloat(t.montoConsumo.replace(/[^0-9.-]+/g,"")),this.totalComision+=parseFloat(t.comision.replace(/[^0-9.-]+/g,"")),this.totalPagar+=parseFloat(t.pagar.replace(/[^0-9.-]+/g,""))}):this.data=[],e))).subscribe(e=>{e&&Array.isArray(e.data)?this.data=e.data:(this.data=[],this.message=e.msg)})}postSave(l){this.pagoAliadoService.postAliados(l).subscribe(e=>{this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.estadosDatosService.stateGrid.next(!0),this.closeDialog()},e=>{this.swalService.ToastAler({icon:"error",title:"Ha ocurrido un error al crear el registro!",timer:4e3})})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=S({type:o,selectors:[["app-form-aliados"]],standalone:!0,features:[w([{provide:B,useClass:H},{provide:O,useValue:"en-GB"},h,f,F,q(Ke)]),A],decls:39,vars:20,consts:[["finalPicker",""],[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"mt-8","text-3xl","font-semibold","leading-tight","tracking-tight","text-center"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","sm:flex-row","md:px-8"],[1,"mt-6","w-full","shrink-0","sm:mt-0","sm:space-x-2","lg:w-full"],[1,"mt-8",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","gap-2.5"],["floatLabel","always",1,"w-full","min-w-90"],["matInput","","placeholder","dd/mm/yyyy",3,"matDatepicker","formControlName"],["matIconSuffix","",3,"for"],["placeholder","Empresa",3,"formControlName"],[4,"ngIf"],[1,"relative","p-4","border","border-gray-300","rounded-lg","mt-4"],[1,"absolute","-top-3","left-4","bg-white","px-2","text-gray-500","font-semibold"],[1,"flex","flex-wrap","justify-end","gap-2.5","sm:mb-4"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-crediblue-50","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"lg:w-auto","w-full","sm:mt-6","transition","duration-200","text-white","font-semibold","rounded-lg","md:w-auto",3,"click","ngClass","disabled"],[1,"flex","flex-auto","overflow-hidden"],[1,"inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"flex","flex-col","gap-4","justify-end","sm:flex-row"],[1,"sm:pr-4","text-gray-600","font-bold","text-right"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:p-4","sm:mb-10","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data"],[1,"inline-block","p-4","sm:p-8","print:p-0","w-full"],[3,"type","appearance"],["fuseAlertTitle",""],[1,"text-gray-800"]],template:function(e,t){if(e&1){let c=re();a(0,"div",1)(1,"div",2),s(2),n(),a(3,"div",3)(4,"div",4)(5,"form",5)(6,"div",6)(7,"mat-form-field",7)(8,"mat-label"),s(9,"Fecha de corte"),n(),u(10,"input",8)(11,"mat-datepicker-toggle",9)(12,"mat-datepicker",null,0),n(),a(14,"mat-form-field",7)(15,"mat-label"),s(16,"Empresa"),n(),a(17,"mat-select",10),y(18,Ue,2,1,"ng-container",11),k(19,"async"),n()()(),a(20,"div",12)(21,"div",13),s(22," Opciones "),n(),a(23,"div",14)(24,"button",15),g("click",function(){return j(c),V(t.closeDialog())}),a(25,"span"),s(26," Atras "),n()(),a(27,"button",16),g("click",function(){return j(c),V(t.onGet())}),a(28,"span"),s(29," Consultar "),n()(),a(30,"button",17),g("click",function(){return j(c),V(t.onSave())}),a(31,"span"),s(32," Pagar "),n()()()()()()(),y(33,ze,3,4,"div",18)(34,Ye,6,3,"div",19),a(35,"div",20),y(36,qe,5,3,"span",21)(37,He,5,3,"span",21)(38,Je,5,3,"span",21),n()()}if(e&2){let c=ne(13);r(2),C(" ","Pago proveedores"," "),r(3),m("formGroup",t.form),r(5),m("matDatepicker",c)("formControlName","fechaFinal"),r(),m("for",c),r(6),m("formControlName","idSubEmpresa"),r(),m("ngIf",I(19,15,t.empresa$)),r(6),m("color","primary"),r(3),m("color","primary"),r(3),m("ngClass",le(17,Re,t.data.length==0,t.data.length>0))("disabled",t.data.length==0),r(3),x(t.data.length?33:t.message?34:-1),r(3),x(t.subtotal?36:-1),r(),x(t.totalComision?37:-1),r(),x(t.totalPagar?38:-1)}},dependencies:[Pe,U,ye,xe,$,Ce,we,Me,Te,ke,_,D,L,he,de,fe,De,me,pe,E,M,se,f,z],styles:[".custom-dialog-container{width:100%}@media (min-width: 1280px){  .custom-dialog-container{width:75%}}"]});let i=o;return i})();var Qe={validation:!1},Ge=(()=>{let o=class o{constructor(){this.fuseService=p(R),this.currencyPipe=p(f),this.decimalPipe=p(F),this.router=p(P),this.activatedRoute=p(ue),this.pagoAliadoService=p(T),this.datePipe=p(h),this.data=[],this.form={fechaCreacion:"",fechaFinal:"",fechaIncial:"",nombreSubempresa:"",total:""},this.columns=["N\xFAmero de factura","Porcentaje","Valor facturado","Total"],this.columnPropertyMap={"N\xFAmero de factura":"numeroFactura",Porcentaje:"porcentaje","Valor facturado":"valorFacturado",Total:"total"}}ngOnInit(){this.id=this.activatedRoute.snapshot.paramMap.get("id"),this.getAliado(this.id)}getAliado(l){this.subscription$=this.pagoAliadoService.getAliado(l).pipe(N(e=>(e.data.detallePagoAliados.forEach(t=>{t.total=this.currencyPipe.transform(t.total,"USD","symbol","1.2-2"),t.valorFacturado=this.currencyPipe.transform(t.valorFacturado,"USD","symbol","1.2-2"),t.porcentaje=this.decimalPipe.transform(t.porcentaje,"1.2-2")+"%"}),e))).subscribe(e=>{e&&Array.isArray(e.data.detallePagoAliados)&&(this.data=e.data.detallePagoAliados,this.form.fechaCreacion=this.datePipe.transform(e.data.fechaCreacion,"dd/MM/YYYY"),this.form.fechaFinal=e.data.fechaFinal,this.form.nombreSubempresa=e.data.nombreSubempresa,this.form.total=this.currencyPipe.transform(e.data.total,"USD","symbol","1.2-2"))})}ngOnDestroy(){this.subscription$.unsubscribe()}closeDialog(){this.router.navigate(["/pages/gestion-cobros/aliados"])}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=S({type:o,selectors:[["app-form-view-aliados"]],standalone:!0,features:[w([{provide:B,useClass:H},{provide:O,useValue:"en-GB"},h,f,F,q(Qe)]),A],decls:32,vars:10,consts:[[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"sm:ml-8","mt-8","text-3xl","font-semibold","leading-tight","tracking-tight"],[1,"relative","flex","flex-0","flex-col","border-b","px-6","sm:flex-row","md:px-8"],[1,"mt-6","w-full","shrink-0","sm:mt-0","sm:space-x-2","lg:w-full"],[1,"mt-8"],[1,"flex","flex-col","sm:flex-row","gap-2.5"],["floatLabel","always",1,"w-full","min-w-90"],["matInput","","placeholder","Empresa","readonly","",3,"value"],[1,"relative","p-2","border","border-gray-300","rounded-lg"],[1,"absolute","-top-3","left-4","bg-white","px-2","text-gray-500","font-semibold"],[1,"flex","flex-wrap","justify-end","gap-2.5","sm:mb-4"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-6","bg-credigray-100","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color"],["mat-flat-button","",1,"lg:w-auto","w-full","sm:mt-6","bg-green-600","transition","duration-200","text-white","font-semibold","rounded-lg","md:w-auto",3,"disabled"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:p-4","sm:mb-10","sm:overflow-y-auto"],[3,"columns","displayedColumns","columnPropertyMap","data"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1),s(2),n(),a(3,"div",2)(4,"div",3)(5,"form",4)(6,"div",5)(7,"mat-form-field",6)(8,"mat-label"),s(9,"Empresa"),n(),u(10,"input",7),n(),a(11,"mat-form-field",6)(12,"mat-label"),s(13,"Fecha de creaci\xF3n"),n(),u(14,"input",7),n(),a(15,"mat-form-field",6)(16,"mat-label"),s(17,"Total"),n(),u(18,"input",7),n()(),a(19,"div",8)(20,"div",9),s(21," Opciones "),n(),a(22,"div",10)(23,"button",11),g("click",function(){return t.closeDialog()}),a(24,"span"),s(25," Atras "),n()(),a(26,"button",12)(27,"span"),s(28," Descargar "),n()()()()()()(),a(29,"div",13)(30,"div",14),u(31,"app-custom-table",15),n()()()),e&2&&(r(2),C(" ","Detalle pago proveedores"," "),r(8),m("value",t.form.nombreSubempresa),r(4),m("value",t.form.fechaCreacion),r(4),m("value",t.form.total),r(5),m("color","primary"),r(3),m("disabled",t.data.length==0),r(5),m("columns",t.columns)("displayedColumns",t.columns)("columnPropertyMap",t.columnPropertyMap)("data",t.data))},dependencies:[M,Fe,U,$,Se,_,L,D,E]});let i=o;return i})();var fi=[{path:"",component:je},{path:"aliado",component:Ve},{path:"detalle/:id",component:Ge}];export{fi as default};
