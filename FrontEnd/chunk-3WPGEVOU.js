import{a as we}from"./chunk-RVCDGTSK.js";import{a as Z}from"./chunk-HCJW2B42.js";import{a as v,b as oe}from"./chunk-E3QK27E6.js";import{a as lt}from"./chunk-VG26ZCBI.js";import{a as mt}from"./chunk-7CDRWLGI.js";import{a as Ee,b as De,c as ot,d as it}from"./chunk-TSZX67OG.js";import{a as U}from"./chunk-FH5YIYVP.js";import{a as st,b as _e}from"./chunk-P4PAYY2C.js";import{a as rt,b as at,c as nt}from"./chunk-LIZCFAUR.js";import{a as P}from"./chunk-NJZGXMCV.js";import{a as tt}from"./chunk-CGCMHNFF.js";import{a as Q}from"./chunk-M6JKQUTX.js";import{a as X,b as et}from"./chunk-QDHNBSMD.js";import{a as ye}from"./chunk-OFI6PGZL.js";import{a as Ye,b as te}from"./chunk-YHNXG437.js";import{a as Se}from"./chunk-VOLXTRGQ.js";import{a as M}from"./chunk-6IEWE3OU.js";import{a as Ke}from"./chunk-PS6I32XU.js";import{a as Je}from"./chunk-JC77WSFI.js";import{g as H}from"./chunk-2XRFSBL3.js";import{c as de}from"./chunk-BF24YLJO.js";import"./chunk-CNRP5CR4.js";import{C as Ce,E as Ue,F as xe,J as z,b as pe,c as Xe,i as q,l as ue,n as b,p as fe,q as be,u as he,x as ve,y as ge}from"./chunk-D3YOWHEC.js";import{b as R,d as B,e as He}from"./chunk-FSJGACMT.js";import{h as L}from"./chunk-AIQUJILU.js";import{a as We}from"./chunk-EZC5HSZS.js";import"./chunk-ZFUJRZBK.js";import{Q as j,R as k,ba as ze,ga as $,ha as Qe,la as ce}from"./chunk-V35GW63T.js";import"./chunk-HADAFI3S.js";import"./chunk-AUCKEBH6.js";import{b as Ze}from"./chunk-2VASWO2B.js";import{Cb as _,Dc as y,Eb as x,Gc as S,Ib as ne,Jb as se,Kb as le,Lb as K,Mb as r,Mc as $e,Nb as f,Ob as me,Qa as s,Qb as Ve,Rb as Ge,Sb as Oe,Tb as Re,Ub as F,Vb as T,Wb as Be,X as ae,Yb as je,ba as Pe,bc as G,cc as ke,dc as Y,ec as ee,ga as Te,gb as h,ha as p,ib as m,l as re,ma as A,q as N,tb as i,ub as o,vb as u,wa as E,wb as W,xa as D,xb as J,xc as Le,yc as qe,zb as V,zc as O}from"./chunk-YBEOGPR3.js";import{a as w,d as Me}from"./chunk-NEB6MB4Y.js";var dt=(()=>{let d=class d{constructor(a,e){this._http=a,this.AppSettings=e}postDesembolso(a){return this._http.post(this.AppSettings.detalleConsumos.url.desembolsoBase,a)}patchDesembolso(a){let e=a.id;delete a.id;let{idEstado:t,idCuentaDestino:c,numeroFactura:g,idCuentaBancaria:C}=a;return this._http.patch(`${this.AppSettings.detalleConsumos.url.base}/${e}?idEstado=${t}&numFactura=${g}&cuentaDestino=${c}&idCuentaBancaria=${C}`,{})}};d.\u0275fac=function(e){return new(e||d)(Te($e),Te(Ze))},d.\u0275prov=Pe({token:d,factory:d.\u0275fac,providedIn:"root"});let n=d;return n})();var vt=["stepper"];function gt(n,d){n&1&&(i(0,"mat-error"),r(1,"El campo es requerido!"),o())}function Ct(n,d){n&1&&(i(0,"mat-error"),r(1,"El valor es requerido!"),o())}function xt(n,d){n&1&&(i(0,"mat-error"),r(1,"El valor ingresado no puede superar el cupo disponible!"),o())}function St(n,d){if(n&1&&(i(0,"mat-option",28),r(1),o()),n&2){let l=d.$implicit;m("value",l.idTipoCuenta),s(),f(l.nombreBanco)}}function yt(n,d){n&1&&(i(0,"mat-error"),r(1,"El campo es requerido!"),o())}function Et(n,d){if(n&1&&(i(0,"div",29)(1,"div",30)(2,"div",31)(3,"h2",32),r(4,"Resumen de desembolso"),o(),i(5,"p",33),r(6,"Revise los detalles"),o()(),i(7,"div",34)(8,"div",35)(9,"div")(10,"h3",36),r(11,"Fecha"),o()(),i(12,"p",37),r(13),G(14,"date"),o()(),i(15,"div",35)(16,"div")(17,"h3",36),r(18,"N\xFAmero de comprobante"),o()(),i(19,"p",37),r(20),o()(),i(21,"div",35)(22,"div")(23,"h3",36),r(24,"Valor"),o()(),i(25,"p",37),r(26),o()(),i(27,"div",35)(28,"div")(29,"h3",36),r(30,"Cuenta de origen"),o()(),i(31,"p",37),r(32),o()(),i(33,"div",38)(34,"div")(35,"h3",36),r(36,"Cuenta destino"),o()(),i(37,"p",37),r(38),o()()()()()),n&2){let l=x();s(13),f(Y(14,5,l.detaleConsumo.fechaCreacion,"dd/MM/yyyy")),s(7),f(l.detaleConsumo.numeroFactura),s(6),f(l.detaleConsumo.montoConsumo),s(6),f(l.detaleConsumo.cuentaOrigen),s(6),f(l.detaleConsumo.cuentaDestino)}}var Dt={validation:!1},pt=(()=>{let d=class d{constructor(){this.fuseService=p(H),this.estadosDatosService=p(Se),this.empleadosServices=p(U),this.cuentasServices=p(mt),this.tipoCuentaService=p(tt),this.datePipe=p(y),this.currencyPipe=p(S),this.router=p(B),this.fb=p(Ce),this.detalleConsumo=p(P),this.cuentas=[],this.desembolsoService=p(dt),this.swalService=p(ye),this.solicitudService=p(Z),this.detalleConsumoService=p(P),this.activatedRoute=p(R),this.errorHandlerService=p(we),this.showAlert=!1,this.alert={type:"success",message:""},this.creditos=[],this.focus=focus,this.FormatoOptionsPipe=lt}ngOnDestroy(){this.subscription$.unsubscribe()}ngOnInit(){this.createForm(),this.getCuentas();let a=this.activatedRoute.snapshot.paramMap.get("id");this.getSolicitud(a)}cerrar(){this.router.navigate(["/pages/gestion-creditos/desembolsos"])}getSolicitud(a){let e;this.subscription$=this.detalleConsumoService.getDetalleConsumoDesembolso(a).pipe(ae(t=>{let c={idTipoDoc:t.data.trabajador.idTipoDoc,numDocumento:t.data.trabajador.numDoc};return e=t.data.montoConsumo,this.empleadosServices.getEmpleadoParams(c)})).subscribe(t=>{if(t){this.showAlert=!1;let c={numDoc:t.data.numDoc,primerNombre:t.data.primerNombre,segundoNombre:t.data.segundoNombre,primerApellido:t.data.primerApellido,segundoApellido:t.data.segundoApellido,idTrabajador:t.data.id,correo:t.data.correo,credito:t.data.creditos[0].numCredito+" - "+this.currencyPipe.transform(t.data.creditos[0].cupoDisponible,"USD","symbol","1.2-2"),idCredito:t.data.creditos[0].id,numCuentaBancaria:t.data.numCuentaBancaria,idTipoCuenta:t.data.idTipoCuenta,id:a};this.secondFormGroup.patchValue(c),this.thirdFormGroup.patchValue({idCuentaBancaria:c.idTipoCuenta,cuentaDestino:c.numCuentaBancaria,montoConsumo:e}),this.creditos=t.data.creditos}},t=>{this.alert={type:"error",message:"El trabajador no existe!"},this.showAlert=!0})}getCuentas(){this.subscription$=this.cuentasServices.getCuentas().subscribe(a=>{this.cuentas=a.data})}selected(a){let e=a.value;this.compareValor=e.cupoDisponible,this.thirdFormGroup.get("montoConsumo").setValidators(_t(this.compareValor)),this.thirdFormGroup.get("montoConsumo").updateValueAndValidity()}compareWithConstants(a){let e=a.value,t=this.secondFormGroup.get("idCredito")?.value;return!t||!t.montoConsumo?(console.error("No se encontr\xF3 el objeto idCredito o montoConsumo"),re(null)):(console.log(e),console.log(t.montoConsumo),e>t.montoConsumo?re({notEqual:!0}):re(null))}get montoConsumo(){return this.thirdFormGroup.get("montoConsumo")}get comprobante(){return this.thirdFormGroup.get("numeroFactura")}get cuentaDestino(){return this.thirdFormGroup.get("cuentaDestino")}onSave(){if(this.thirdFormGroup.valid){let a=this.thirdFormGroup.getRawValue(),{montoConsumo:e,idCuentaBancaria:t,cuentaDestino:c}=a,g=Me(a,["montoConsumo","idCuentaBancaria","cuentaDestino"]),{id:C,idCredito:I,idTrabajador:bt}=this.secondFormGroup.getRawValue();console.log(I);let Ie=this.cuentas.filter(ie=>{if(ie.idTipoCuenta==t)return ie.id});console.log(Ie[0].id);let Ne=w({id:C,idEstado:oe.REALIZADA,idCuentaDestino:c,idCuentaBancaria:Ie[0].id},g);console.log(Ne),this.fuseService.open(w({},te)).afterClosed().subscribe(ie=>{ie==="confirmed"&&this.desembolsoService.patchDesembolso(Ne).subscribe(Fe=>{console.log(Fe),this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.getResumenCompra(bt)},Fe=>{this.errorHandlerService.errorHandler(Fe)})})}}getResumenCompra(a){this.subscription$=this.detalleConsumo.getResumen(a).subscribe(e=>{e&&(console.log(e),this.detaleConsumo=e.data,this.stepper.next(),setTimeout(()=>{this.cerrar()},5e3))})}createForm(){this.secondFormGroup=this.fb.group({numDoc:["",b.required],primerNombre:["",b.required],segundoNombre:[""],primerApellido:["",b.required],segundoApellido:[""],idTrabajador:[""],correo:["",b.required],credito:["",b.required],idCredito:["",b.required],numCuentaBancaria:[""],idTipoCuenta:[""],id:[""]}),this.thirdFormGroup=this.fb.group({montoConsumo:[{value:0,disabled:!0},[b.required]],numeroFactura:["",b.required],idCuentaBancaria:["",b.required],cuentaDestino:["",b.required]})}};d.\u0275fac=function(e){return new(e||d)},d.\u0275cmp=A({type:d,selectors:[["app-form-desembolso"]],viewQuery:function(e,t){if(e&1&&ne(vt,5),e&2){let c;se(c=le())&&(t.stepper=c.first)}},standalone:!0,features:[F([{provide:k,useClass:Q},{provide:j,useValue:"en-GB"},y,S,X(Dt)]),T],decls:84,vars:29,consts:[["stepper",""],["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","items-center","overflow-y-auto","bg-gray-100","p-6","sm:p-8"],[1,"relative","w-full","flex-0","max-w-4xl","sm:rounded-lg","overflow-hidden"],[1,"p-2","text-3xl","font-semibold","text-center","text-gray-800"],[1,"w-full","px-6","py-4",3,"orientation","linear","animationDuration"],["label","Verificar informaci\xF3n",3,"stepControl"],[1,"w-full"],[1,"space-y-4","w-full","max-w-lg","mx-auto",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","gap-4"],["matInput","","readonly","",3,"formControlName"],[1,"flex","flex-col"],[1,"flex","flex-wrap","justify-center","sm:justify-center","gap-4","mt-2"],["mat-button","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-crediorange-100","rounded-lg",3,"click"],["mat-button","","matStepperNext","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-crediblue-50","rounded-lg","hover:bg-opacity-80",3,"disabled"],["label","Confirmar desembolso",3,"stepControl"],[1,"w-full","h-full","p-4","sm:p-8"],[1,"flex","flex-col","sm:flex-row","items-baseline","gap-4"],["floatLabel","always",1,"w-full"],["matInput","","placeholder","N\xFAmero de comprobante",3,"formControlName"],[4,"ngIf"],["matInput","","thousandSeparator",".","placeholder","Valor",3,"formControlName","mask"],["placeholder","Cuenta de origen",3,"formControlName"],[3,"value",4,"ngFor","ngForOf"],["matInput","","placeholder","Cuenta destino",3,"formControlName"],["mat-button","","matStepperPrevious","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-gray-500","rounded-lg","hover:bg-gray-600"],["mat-button","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-crediblue-50","rounded-lg","hover:bg-opacity-80",3,"click","disabled"],["label","Resumen de desembolso"],["class","w-full px-4 sm:px-8",4,"ngIf"],[3,"value"],[1,"w-full","px-4","sm:px-8"],[1,"max-w-2xl","mx-auto","p-6","bg-white","shadow-lg","rounded-lg"],[1,"border-b","pb-4","mb-4","text-center"],[1,"text-2xl","font-bold","text-gray-800"],[1,"text-sm","text-gray-500"],[1,"space-y-4"],[1,"flex","justify-between","items-center","border-b","pb-2"],[1,"text-lg","font-semibold","text-gray-700"],[1,"text-lg","font-bold","text-gray-800"],[1,"flex","justify-between","items-center"]],template:function(e,t){if(e&1){let c=V();i(0,"div",1)(1,"div",2)(2,"div",3),r(3),o(),i(4,"mat-stepper",4,0)(6,"mat-step",5)(7,"div",6)(8,"form",7)(9,"div",8)(10,"mat-form-field",6)(11,"mat-label"),r(12,"Primer nombre"),o(),u(13,"input",9),o(),i(14,"mat-form-field",6)(15,"mat-label"),r(16,"Segundo nombre"),o(),u(17,"input",9),o()(),i(18,"div",8)(19,"mat-form-field",6)(20,"mat-label"),r(21,"Primer apellido"),o(),u(22,"input",9),o(),i(23,"mat-form-field",6)(24,"mat-label"),r(25,"Segundo apellido"),o(),u(26,"input",9),o()(),i(27,"div",8)(28,"mat-form-field",6)(29,"mat-label"),r(30,"Identificaci\xF3n"),o(),u(31,"input",9),o(),i(32,"mat-form-field",6)(33,"mat-label"),r(34,"Email"),o(),u(35,"input",9),o()(),i(36,"div",10)(37,"mat-form-field",6)(38,"mat-label"),r(39,"Cr\xE9dito"),o(),u(40,"input",9),o()(),i(41,"div",10)(42,"mat-form-field",6)(43,"mat-label"),r(44,"N\xFAmero de cuenta"),o(),u(45,"input",9),o()()(),i(46,"div",11)(47,"button",12),_("click",function(){return E(c),D(t.cerrar())}),r(48,"Cancelar"),o(),i(49,"button",13),r(50,"Siguiente"),o()()()(),i(51,"mat-step",14)(52,"div",15)(53,"form",7)(54,"div",16)(55,"mat-form-field",17)(56,"mat-label"),r(57,"N\xFAmero de comprobante"),o(),u(58,"input",18),h(59,gt,2,0,"mat-error",19),o(),i(60,"mat-form-field",17)(61,"mat-label"),r(62,"Valor de la transferencia"),o(),u(63,"input",20),h(64,Ct,2,0,"mat-error",19)(65,xt,2,0,"mat-error",19),o()(),i(66,"div",8)(67,"mat-form-field",17)(68,"mat-label"),r(69,"Cuenta de origen"),o(),i(70,"mat-select",21),h(71,St,2,2,"mat-option",22),o()(),i(72,"mat-form-field",17)(73,"mat-label"),r(74,"Cuenta destino"),o(),u(75,"input",23),h(76,yt,2,0,"mat-error",19),o()()(),i(77,"div",11)(78,"button",24),r(79,"Anterior"),o(),i(80,"button",25),_("click",function(){return E(c),D(t.onSave())}),r(81,"Confirmar"),o()()()(),i(82,"mat-step",26),h(83,Et,39,8,"div",27),o()()()()}e&2&&(s(3),me(" ","Desembolso"," "),s(),m("orientation","vertical")("linear",!0)("animationDuration","1500"),s(2),m("stepControl",t.secondFormGroup),s(2),m("formGroup",t.secondFormGroup),s(5),m("formControlName","primerNombre"),s(4),m("formControlName","segundoNombre"),s(5),m("formControlName","primerApellido"),s(4),m("formControlName","segundoApellido"),s(5),m("formControlName","numDoc"),s(4),m("formControlName","correo"),s(5),m("formControlName","credito"),s(5),m("formControlName","numCuentaBancaria"),s(4),m("disabled",t.secondFormGroup.invalid),s(2),m("stepControl",t.thirdFormGroup),s(2),m("formGroup",t.thirdFormGroup),s(5),m("formControlName","numeroFactura"),s(),m("ngIf",(t.comprobante.touched||t.comprobante.dirty)&&t.comprobante.hasError("required")),s(4),m("formControlName","montoConsumo")("mask","separator.0"),s(),m("ngIf",(t.montoConsumo.touched||t.montoConsumo.dirty)&&t.montoConsumo.hasError("required")),s(),m("ngIf",(t.montoConsumo.touched||t.montoConsumo.dirty)&&t.montoConsumo.hasError("notEqual")),s(5),m("formControlName","idCuentaBancaria"),s(),m("ngForOf",t.cuentas),s(4),m("formControlName","cuentaDestino"),s(),m("ngIf",(t.cuentaDestino.touched||t.cuentaDestino.dirty)&&t.cuentaDestino.hasError("required")),s(4),m("disabled",t.thirdFormGroup.invalid),s(3),m("ngIf",t.detaleConsumo))},dependencies:[L,y,Ue,he,ue,fe,be,$,Xe,q,z,pe,ze,Je,Ee,De,ot,it,qe,O,et,xe,ve,ge]});let n=d;return n})();function _t(n){return d=>{let l=d.value;return console.log(n),l>n?{notEqual:!0}:null}}var wt=(n,d)=>({"bg-green-700":n,"bg-credigray-100":d});function At(n,d){if(n&1&&(W(0),u(1,"app-custom-table",19),J()),n&2){let l=x(2);s(),m("columns",l.columns)("displayedColumns",l.columns)("columnPropertyMap",l.columnPropertyMap)("data",l.data)("buttons",l.buttonsPendiente)("searchTerm",l.searchTerm)}}function Ft(n,d){n&1&&(i(0,"div",20)(1,"div",21)(2,"fuse-alert",22)(3,"span",23),r(4,"Informaci\xF3n"),o(),r(5," No hay solicitudes hasta el momento. "),o()()()),n&2&&(s(2),m("type","info")("appearance","outline"))}function Tt(n,d){if(n&1&&h(0,At,2,6,"ng-container",18)(1,Ft,6,2,"ng-template",null,1,ee),n&2){let l=K(2),a=x();m("ngIf",a.data.length)("ngIfElse",l)}}function It(n,d){if(n&1&&(W(0),u(1,"app-custom-table",19),J()),n&2){let l=x(2);s(),m("columns",l.columns)("displayedColumns",l.columns)("columnPropertyMap",l.columnPropertyMap)("data",l.data)("buttons",l.buttons)("searchTerm",l.searchTerm)}}function Nt(n,d){n&1&&(i(0,"div",20)(1,"div",21)(2,"fuse-alert",22)(3,"span",23),r(4,"Informaci\xF3n"),o(),r(5," No hay solicitudes rechazadas hasta el momento. "),o()()()),n&2&&(s(2),m("type","info")("appearance","outline"))}function Mt(n,d){if(n&1&&h(0,It,2,6,"ng-container",18)(1,Nt,6,2,"ng-template",null,1,ee),n&2){let l=K(2),a=x();m("ngIf",a.data.length)("ngIfElse",l)}}function Pt(n,d){if(n&1&&(W(0),u(1,"app-custom-table",19),J()),n&2){let l=x(2);s(),m("columns",l.columnsDesembolsos)("displayedColumns",l.columnsDesembolsos)("columnPropertyMap",l.columnPropertyMapDesembolsos)("data",l.data)("buttons",l.buttonsApprove)("searchTerm",l.searchTerm)}}function Vt(n,d){n&1&&(i(0,"div",20)(1,"div",21)(2,"fuse-alert",22)(3,"span",23),r(4,"Informaci\xF3n"),o(),r(5," No hay solicitudes aprobadas hasta el momento. "),o()()()),n&2&&(s(2),m("type","info")("appearance","outline"))}function Gt(n,d){if(n&1&&h(0,Pt,2,6,"ng-container",18)(1,Vt,6,2,"ng-template",null,1,ee),n&2){let l=K(2),a=x();m("ngIf",a.data.length)("ngIfElse",l)}}function Ot(n,d){if(n&1&&(W(0),u(1,"app-custom-table",19),J()),n&2){let l=x(2);s(),m("columns",l.columnsDesembolsos)("displayedColumns",l.columnsDesembolsos)("columnPropertyMap",l.columnPropertyMapDesembolsos)("data",l.data)("buttons",l.buttonsView)("searchTerm",l.searchTerm)}}function Rt(n,d){n&1&&(i(0,"div",20)(1,"div",21)(2,"fuse-alert",22)(3,"span",23),r(4,"Informaci\xF3n"),o(),r(5," No hay solicitudes aprobadas hasta el momento. "),o()()()),n&2&&(s(2),m("type","info")("appearance","outline"))}function Bt(n,d){if(n&1&&h(0,Ot,2,6,"ng-container",18)(1,Rt,6,2,"ng-template",null,1,ee),n&2){let l=K(2),a=x();m("ngIf",a.data.length)("ngIfElse",l)}}var ct=(()=>{let d=class d{constructor(){this.datePipe=p(y),this.currencyPipe=p(S),this.router=p(B),this.selectedTab=v.PENDIENTE_DESEMBOLSO,this._matDialog=p(de),this.estadoDatosService=p(Se),this.solicitudService=p(Z),this.detalleConsumoService=p(P),this.fuseService=p(H),this.searchTerm="",this.data=[],this.columns=["Fecha de solicitud","Trabajador","Cupo solicitado","Empresa","Estado"],this.columnPropertyMap={"Fecha de solicitud":"fechaCreacion",Trabajador:"nombreTrabajador","Cupo solicitado":"cupo",Empresa:"nombreSubEmpresa",Estado:"nombreEstadoSolicitud"},this.columnsDesembolsos=["Fecha de aprobaci\xF3n","Trabajador","Cupo aprobado","Empresa","Estado"],this.columnPropertyMapDesembolsos={"Fecha de aprobaci\xF3n":"fechaCreacion",Trabajador:"nombreTrabajador","Cupo aprobado":"montoConsumo",Empresa:"nombreSubEmpresa",Estado:"nombreEstadoCredito"},this.buttons=[{label:"View",icon:"visibility",action:a=>{console.log("Approve",a),this.selectedData=a,this.router.navigate(["pages/gestion-creditos/solicitudes/estados",this.selectedData.id])}}],this.buttonsApprove=[{label:"View",icon:"visibility",action:a=>{console.log("Approve",a),this.selectedData=a,this.router.navigate(["pages/gestion-creditos/desembolsos/registrar",this.selectedData.id])}}],this.buttonsView=[{label:"View",icon:"visibility",action:a=>{console.log("Approve",a),this.selectedData=a,this.router.navigate(["pages/gestion-creditos/desembolsos/view",this.selectedData.id])}}],this.buttonsPendiente=[{label:"View",icon:"visibility",action:a=>{console.log("Approve",a),this.selectedData=a,this.router.navigate(["pages/gestion-creditos/desembolsos/desembolso",this.selectedData.id])}}],this.tabChanged=a=>{this.tabIndex=a.index,this.selectedTab=a.index==0?v.PENDIENTE_DESEMBOLSO:a.index==1?v.RECHAZADA_DESEMBOLSO:a.index==2?v.APROBADO_DESEMBOLSO:a.index==3?v.REALIZADA_DESEMBOLSO:v.APROBADA,[v.PENDIENTE_DESEMBOLSO,v.RECHAZADA_DESEMBOLSO].includes(this.selectedTab)?this.getSolicitudes(this.selectedTab):[v.APROBADO_DESEMBOLSO,v.REALIZADA_DESEMBOLSO].includes(this.selectedTab)&&this.getDesembolsos(this.selectedTab)}}getSolicitudes(a){this.subcription$=this.solicitudService.getSolicitudes(a).pipe(N(e=>(e.data.forEach(t=>{t.estado?t.estado=M.ACTIVO:t.estado=M.INACTIVO}),e)),N(e=>(e.data.forEach(t=>{t.fechaCreacion=this.datePipe.transform(t.fechaCreacion,"dd/MM/yyyy"),t.cupo=this.currencyPipe.transform(t.cupo,"USD","symbol","1.2-2")}),e))).subscribe(e=>{e?this.data=e.data:this.data=[]},e=>{this.data=[]})}getDesembolsos(a){a==v.APROBADO_DESEMBOLSO?this.subcription$=this.detalleConsumoService.getDetalleConsumoDesembolsos().pipe(N(e=>(e.data.forEach(t=>{t.estado?t.estado=M.ACTIVO:t.estado=M.INACTIVO}),e)),N(e=>(e.data.forEach(t=>{t.fechaCreacion=this.datePipe.transform(t.fechaCreacion,"dd/MM/yyyy"),t.montoConsumo=this.currencyPipe.transform(t.montoConsumo,"USD","symbol","1.2-2")}),e))).subscribe(e=>{e?this.data=e.data:this.data=[]},e=>{this.data=[]}):this.subcription$=this.detalleConsumoService.getDetalleConsumoDesembolsosRealizado().pipe(N(e=>(e.data.forEach(t=>{t.estado?t.estado=M.ACTIVO:t.estado=M.INACTIVO}),e)),N(e=>(e.data.forEach(t=>{t.fechaCreacion=this.datePipe.transform(t.fechaCreacion,"dd/MM/yyyy"),t.montoConsumo=this.currencyPipe.transform(t.montoConsumo,"USD","symbol","1.2-2")}),e))).subscribe(e=>{e?this.data=e.data:this.data=[]},e=>{this.data=[]})}onSearch(a){let e=a.target;this.searchTerm=e.value.trim().toLowerCase()}ngOnDestroy(){this.subcription$.unsubscribe()}ngOnInit(){this.getSolicitudes(this.selectedTab),this.listenGrid()}listenGrid(){this.estadoDatosService.stateGridSolicitudes.asObservable().subscribe(e=>{e.state&&(console.log("Si entro"),console.log(e),this.selectedTab=e.tab==0?v.PENDIENTE:e.tab==1?v.RECHAZADA:e.tab==2?v.APROBADA:e.tab==3?v.REALIZADA_DESEMBOLSO:v.APROBADA,this.tabIndex=e.tab)})}exportToExcel(a){this.fuseService.open(w({},Ye)).afterClosed().subscribe(t=>{if(t==="confirmed"){let c=_e.json_to_sheet(a),g=_e.book_new();_e.book_append_sheet(g,c,"Sheet1"),st(g,"exported_data.xlsx")}})}};d.\u0275fac=function(e){return new(e||d)},d.\u0275cmp=A({type:d,selectors:[["app-grid-desembolsos"]],standalone:!0,features:[F([y,S]),T],decls:23,vars:12,consts:[["tabGroup",""],["noData",""],[1,"bg-card","flex","min-w-0","flex-auto","flex-col","dark:bg-transparent","sm:absolute","sm:inset-0","sm:overflow-hidden"],[1,"relative","flex","flex-0","flex-col","px-6","py-6","sm:flex-row","sm:items-center","sm:justify-between","md:px-8"],[1,"text-3xl","font-semibold","tracking-tight"],[1,"mt-6","flex","w-full","shrink-0","flex-col","items-center","sm:ml-4","sm:mt-0","sm:flex-row","sm:space-x-2","sm:w-auto"],[1,"fuse-mat-dense","rounded-lg","w-full","sm:w-auto","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"input","autocomplete","placeholder"],["mat-flat-button","",1,"sm:w-auto","w-full","sm:mt-0","mt-2","rounded-lg","transition","duration-200","text-white","font-semibold",3,"click","color","ngClass","disabled"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-auto","flex-col","overflow-hidden","sm:overflow-y-auto","bg-gray-100"],["mat-stretch-tabs","false",1,"sm:px-2",3,"selectedIndexChange","selectedTabChange","animationDuration","selectedIndex"],["label","Pendientes"],["matTabContent",""],["label","Rechazadas"],["label","Aprobadas"],["label","Realizados"],[4,"ngIf","ngIfElse"],[3,"columns","displayedColumns","columnPropertyMap","data","buttons","searchTerm"],[1,"inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"inline-block","p-4","sm:p-2","print:p-0","w-full"],[3,"type","appearance"],["fuseAlertTitle",""]],template:function(e,t){if(e&1){let c=V();i(0,"div",2)(1,"div",3)(2,"div",4),r(3,"Desembolsos"),o(),i(4,"div",5)(5,"mat-form-field",6),u(6,"mat-icon",7),i(7,"input",8),_("input",function(C){return E(c),D(t.onSearch(C))}),o()(),i(8,"button",9),_("click",function(){return E(c),D(t.exportToExcel(t.data))}),i(9,"span"),r(10," Exportar "),o()()()(),i(11,"div",10)(12,"div",11)(13,"mat-tab-group",12,0),Re("selectedIndexChange",function(C){return E(c),Oe(t.tabIndex,C)||(t.tabIndex=C),D(C)}),_("selectedTabChange",function(C){return E(c),D(t.tabChanged(C))}),i(15,"mat-tab",13),h(16,Tt,3,2,"ng-template",14),o(),i(17,"mat-tab",15),h(18,Mt,3,2,"ng-template",14),o(),i(19,"mat-tab",16),h(20,Gt,3,2,"ng-template",14),o(),i(21,"mat-tab",17),h(22,Bt,3,2,"ng-template",14),o()()()()()}e&2&&(s(5),m("subscriptSizing","dynamic"),s(),m("svgIcon","heroicons_solid:magnifying-glass"),s(),m("autocomplete","off")("placeholder","Buscar"),s(),m("color","primary")("ngClass",je(9,wt,t.data.length,!t.data.length))("disabled",!t.data.length),s(5),m("animationDuration","500"),Ge("selectedIndex",t.tabIndex))},dependencies:[Ke,We,$,q,ce,z,at,rt,nt,O,Le]});let n=d;return n})();var jt=["stepper"],kt={validation:!1},ut=(()=>{let d=class d{constructor(){this.fuseService=p(H),this.router=p(B),this.fb=p(Ce),this.activatedRoute=p(R),this.solicitudService=p(Z),this.empleadosServices=p(U),this.currencyPipe=p(S),this.swalService=p(ye),this.errorHandlerService=p(we),this.showAlert=!1,this.alert={type:"success",message:""}}ngOnDestroy(){}ngOnInit(){this.createForm();let a=this.activatedRoute.snapshot.paramMap.get("id");this.getSolicitud(a)}getSolicitud(a){this.subscription$=this.solicitudService.getSolicitud(a).pipe(ae(e=>{let t={idTipoDoc:e.data.trabajador.idTipoDoc,numDocumento:e.data.trabajador.numDoc};return this.empleadosServices.getEmpleadoParams(t)})).subscribe(e=>{if(e){this.showAlert=!1;let t={numDoc:e.data.numDoc,primerNombre:e.data.primerNombre,segundoNombre:e.data.segundoNombre,primerApellido:e.data.primerApellido,segundoApellido:e.data.segundoApellido,idTrabajador:e.data.id,correo:e.data.correo,credito:e.data.creditos[0].numCredito+" - "+this.currencyPipe.transform(e.data.creditos[0].cupoDisponible,"USD","symbol","1.2-2"),idCredito:e.data.creditos[0].id,numCuentaBancaria:e.data.numCuentaBancaria,idTipoCuenta:e.data.idTipoCuenta,id:a};this.secondFormGroup.patchValue(t)}},e=>{this.alert={type:"error",message:"El trabajador no existe!"},this.showAlert=!0})}onApprove(){if(this.secondFormGroup.valid){let{id:a,idCredito:e,idTrabajador:t}=this.secondFormGroup.getRawValue(),c={id:a,idEstado:oe.APROBADA};this.fuseService.open(w({},te)).afterClosed().subscribe(C=>{C==="confirmed"&&this.solicitudService.patchSolicitudDesembolso(c).subscribe(I=>{this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.router.navigate(["pages/gestion-creditos/desembolsos"])},I=>{this.errorHandlerService.errorHandler(I)})})}}onRechazar(){if(this.secondFormGroup.valid){let{id:a,idCredito:e,idTrabajador:t}=this.secondFormGroup.getRawValue(),c={id:a,idEstado:oe.RECHAZADA};this.fuseService.open(w({},te)).afterClosed().subscribe(C=>{C==="confirmed"&&this.solicitudService.patchSolicitudDesembolso(c).subscribe(I=>{this.swalService.ToastAler({icon:"success",title:"Registro Creado o Actualizado con Exito.",timer:4e3}),this.router.navigate(["pages/gestion-creditos/desembolsos"])},I=>{this.errorHandlerService.errorHandler(I)})})}}cerrar(){this.router.navigate(["/pages/gestion-creditos/desembolsos"])}createForm(){this.secondFormGroup=this.fb.group({numDoc:["",b.required],primerNombre:["",b.required],segundoNombre:[""],primerApellido:["",b.required],segundoApellido:[""],idTrabajador:[""],correo:["",b.required],credito:["",b.required],idCredito:["",b.required],numCuentaBancaria:[""],idTipoCuenta:[""],id:[""]})}};d.\u0275fac=function(e){return new(e||d)},d.\u0275cmp=A({type:d,selectors:[["app-form-approve-desembolso"]],viewQuery:function(e,t){if(e&1&&ne(jt,5),e&2){let c;se(c=le())&&(t.stepper=c.first)}},standalone:!0,features:[F([{provide:k,useClass:Q},{provide:j,useValue:"en-GB"},y,S,X(kt)]),T],decls:51,vars:14,consts:[["stepper",""],["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","items-center","overflow-y-auto","bg-gray-100","p-6","sm:p-8"],[1,"relative","w-full","flex-0","max-w-4xl","sm:rounded-lg","overflow-hidden"],[1,"p-2","text-3xl","font-semibold","text-center","text-gray-800"],[1,"w-full","px-6","py-4",3,"orientation","linear","animationDuration"],["label","Verificar informaci\xF3n",3,"stepControl"],[1,"w-full"],[1,"space-y-4","w-full","max-w-lg","mx-auto",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","gap-4"],["matInput","","readonly","",3,"formControlName"],[1,"flex","flex-col"],[1,"flex","flex-wrap","justify-center","sm:justify-center","gap-4","mt-2"],["mat-button","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-crediorange-100","rounded-lg",3,"click"],["mat-button","",1,"sm:w-auto","w-full","py-2","px-4","text-white","bg-crediblue-50","rounded-lg","hover:bg-opacity-80",3,"click"]],template:function(e,t){if(e&1){let c=V();i(0,"div",1)(1,"div",2)(2,"div",3),r(3),o(),i(4,"mat-stepper",4,0)(6,"mat-step",5)(7,"div",6)(8,"form",7)(9,"div",8)(10,"mat-form-field",6)(11,"mat-label"),r(12,"Primer nombre"),o(),u(13,"input",9),o(),i(14,"mat-form-field",6)(15,"mat-label"),r(16,"Segundo nombre"),o(),u(17,"input",9),o()(),i(18,"div",8)(19,"mat-form-field",6)(20,"mat-label"),r(21,"Primer apellido"),o(),u(22,"input",9),o(),i(23,"mat-form-field",6)(24,"mat-label"),r(25,"Segundo apellido"),o(),u(26,"input",9),o()(),i(27,"div",8)(28,"mat-form-field",6)(29,"mat-label"),r(30,"Identificaci\xF3n"),o(),u(31,"input",9),o(),i(32,"mat-form-field",6)(33,"mat-label"),r(34,"Email"),o(),u(35,"input",9),o()(),i(36,"div",10)(37,"mat-form-field",6)(38,"mat-label"),r(39,"Cr\xE9dito"),o(),u(40,"input",9),o()(),i(41,"div",10)(42,"mat-form-field",6)(43,"mat-label"),r(44,"N\xFAmero de cuenta"),o(),u(45,"input",9),o()()(),i(46,"div",11)(47,"button",12),_("click",function(){return E(c),D(t.onRechazar())}),r(48,"Rechazar"),o(),i(49,"button",13),_("click",function(){return E(c),D(t.onApprove())}),r(50,"Aprobar"),o()()()()()()()}e&2&&(s(3),me(" ","Desembolso"," "),s(),m("orientation","vertical")("linear",!0)("animationDuration","1500"),s(2),m("stepControl",t.secondFormGroup),s(2),m("formGroup",t.secondFormGroup),s(5),m("formControlName","primerNombre"),s(4),m("formControlName","segundoNombre"),s(5),m("formControlName","primerApellido"),s(4),m("formControlName","segundoApellido"),s(5),m("formControlName","numDoc"),s(4),m("formControlName","correo"),s(5),m("formControlName","credito"),s(5),m("formControlName","numCuentaBancaria"))},dependencies:[L,De,$,q,z,pe,Ee,xe,he,ue,fe,be,ve,ge]});let n=d;return n})();var Lt=()=>["/pages/gestion-creditos/desembolsos"];function qt(n,d){if(n&1&&(i(0,"div",8)(1,"div",9)(2,"div")(3,"h3",10),r(4),o(),i(5,"p",11),r(6,"Identificaci\xF3n: "),i(7,"span",12),r(8),o()(),i(9,"p",11),r(10,"Empresa: "),i(11,"span",12),r(12),o()(),i(13,"p",13),r(14,"Cargo: "),i(15,"span",12),r(16),o()(),i(17,"p",13),r(18,"Tipo de contrato: "),i(19,"span",12),r(20),o()(),i(21,"p",13),r(22,"Salario devengado: "),i(23,"span",12),r(24),G(25,"currency"),o()(),i(26,"p",11),r(27,"Correo: "),i(28,"span",12),r(29),o()(),i(30,"p",11),r(31,"Direcci\xF3n: "),i(32,"span",12),r(33),o()(),i(34,"p",11),r(35,"Tel\xE9fono: "),i(36,"span",12),r(37),o()()(),i(38,"div")(39,"p",11),r(40,"Estado de Desembolso: "),i(41,"span",12),r(42),o()(),i(43,"p",11),r(44,"Valor de desembolso: "),i(45,"span",12),r(46),G(47,"currency"),o()(),i(48,"p",11),r(49,"Fecha de Solicitud: "),i(50,"span",12),r(51),G(52,"date"),o()()()()()),n&2){let l=x();s(4),Ve(" ",l.items.trabajador.primerNombre," ",l.items.trabajador.segundoNombre," ",l.items.trabajador.primerApellido," ",l.items.trabajador.segundoApellido," "),s(4),f(l.items.trabajador.numDoc),s(4),f(l.items.nombreSubEmpresa),s(4),f(l.items.trabajador.cargo),s(4),f(l.items.trabajador.nombreTipoContrato),s(4),f(Y(25,15,l.items.trabajador.salarioDevengado,"USD")),s(5),f(l.items.trabajador.correo),s(4),f(l.items.trabajador.direccion),s(4),f(l.items.trabajador.telefono),s(5),f(l.items.nombreEstadoCredito),s(4),f(ke(47,18,l.items.montoConsumo)),s(5),f(Y(52,20,l.items.fechaCreacion,"dd/MM/yyyy"))}}var $t={validation:!1},ft=(()=>{let d=class d{constructor(){this.activatedRoute=p(R),this._matDialog=p(de),this.detalleConsumoService=p(P),this.currencyPipe=p(S),this.empleadosServices=p(U),this.showAlert=!1,this.alert={type:"success",message:""}}ngOnDestroy(){this.subscription$.unsubscribe()}ngOnInit(){let a=this.activatedRoute.snapshot.paramMap.get("id");this.getSolicitud(a)}getSolicitud(a){this.subscription$=this.detalleConsumoService.getDetalleConsumoDesembolso(a).subscribe(e=>{e&&(this.showAlert=!1,this.items=e.data)},e=>{this.alert={type:"error",message:"El trabajador no existe!"},this.showAlert=!0})}};d.\u0275fac=function(e){return new(e||d)},d.\u0275cmp=A({type:d,selectors:[["app-form-view-desembolso"]],standalone:!0,features:[F([{provide:k,useClass:Q},{provide:j,useValue:"en-GB"},y,S,X($t)]),T],decls:10,vars:4,consts:[["cdkScrollable","",1,"absolute","inset-0","min-w-0","overflow-auto","print:overflow-visible"],[1,"inline-block","p-4","sm:p-6","md:p-10","print:p-0","w-full"],[1,"bg-card","shadow","print:bg-transparent","print:p-0","print:shadow-none","rounded-2xl","max-w-4xl","mx-auto","overflow-hidden"],[1,"bg-crediblue-50","px-4","py-3","sm:px-6","sm:py-4","flex","items-center","justify-between"],["mat-button","",1,"flex","items-center",3,"routerLink"],[1,"text-white",3,"svgIcon"],[1,"text-lg","sm:text-xl","font-bold","text-white"],["class","p-4 sm:p-6",4,"ngIf"],[1,"p-4","sm:p-6"],[1,"mb-4","flex","flex-col","md:flex-row","md:justify-between","gap-4"],[1,"text-lg","sm:text-xl","font-semibold","text-gray-800"],[1,"font-medium","text-gray-600"],[1,"text-md","text-secondary"],[1,"text-gray-600","font-medium"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"a",4),u(6,"mat-icon",5),o()(),i(7,"h2",6),r(8,"Detalle de Desembolso"),o()(),h(9,qt,53,23,"div",7),o()()()),e&2&&(s(5),m("routerLink",Be(3,Lt)),s(),m("svgIcon","heroicons_outline:arrow-long-left"),s(3),m("ngIf",t.items))},dependencies:[L,S,y,Qe,ce,O,He]});let n=d;return n})();var zi=[{path:"",component:ct},{path:"desembolso/:id",component:ut},{path:"registrar/:id",component:pt},{path:"view/:id",component:ft}];export{zi as default};
