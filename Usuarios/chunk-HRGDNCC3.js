import{e as b}from"./chunk-KQIANWZY.js";import{b as _}from"./chunk-IA45D4ZE.js";import{q as h}from"./chunk-IH3W2H2R.js";import{D as k,W as f,Z as T,ba as p,h as g,ha as n,l as a,q as u}from"./chunk-T2GNEYCX.js";import{a as m}from"./chunk-NEB6MB4Y.js";var w=(()=>{let e=class e{constructor(){this._httpClient=n(h),this._user=new g(1)}set user(t){this._user.next(t)}get user$(){return this._user.asObservable()}get(){return this._httpClient.get("api/common/user").pipe(T(t=>{this._user.next(t)}))}update(t){return this._httpClient.patch("api/common/user",{user:t}).pipe(u(s=>{this._user.next(s)}))}};e.\u0275fac=function(s){return new(s||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var l=class{static isTokenExpired(e,r){if(!e||e==="")return!0;let t=this._getTokenExpirationDate(e);return r=r||0,t===null?!0:!(t.valueOf()>new Date().valueOf()+r*1e3)}static _b64decode(e){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let s=0,c,i,d=0;i=e.charAt(d++);~i&&(c=s%4?c*64+i:i,s++%4)?t+=String.fromCharCode(255&c>>(-2*s&6)):0)i=r.indexOf(i);return t}static _b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this._b64decode(e),r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))}static _urlBase64Decode(e){let r=e.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:{r+="==";break}case 3:{r+="=";break}default:throw Error("Illegal base64url string!")}return this._b64DecodeUnicode(r)}static _decodeToken(e){if(!e)return null;let r=e.split(".");if(r.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let t=this._urlBase64Decode(r[1]);if(!t)throw new Error("Cannot decode the token.");return JSON.parse(t)}static _getTokenExpirationDate(e){let r=this._decodeToken(e);if(r.iat=new Date(r.iat),r.iat=Math.floor(r.iat.getTime()/1e4),!r.hasOwnProperty("exp"))return null;let t=new Date(0);return t.setUTCSeconds(r.exp),t.setUTCSeconds(r.exp),t}};var B=(()=>{let e=class e{constructor(){this._authenticated=!1,this._httpClient=n(h),this._userService=n(w),this._appSettings=n(_),this.aesEncriptService=n(b)}set accessToken(t){localStorage.setItem("accessToken",t)}get accessToken(){return localStorage.getItem("accessToken")??""}forgotPassword(t){return this._httpClient.post("api/auth/forgot-password",t)}resetPassword(t){return this._httpClient.post("api/auth/reset-password",t)}signIn(t){let s={correo:t.correo,contrasena:t.contrasena,idTipoUsuario:t.idTipoUsuario},c={login:this.aesEncriptService.encryptObject(s)};return this._httpClient.post(this._appSettings.auth.url.base,c).pipe(u(i=>{let d={id:Math.random().toString(),name:i.data.nombre,email:i.data.correo,avatar:"images/avatars/avatar-user.png",status:"online"};return i.tokenType="bearer",i.user=m({},d),delete i.data,i}),f(i=>(this.accessToken=i.accessToken,this._authenticated=!0,this._userService.user=i.user,a(i))))}signInUsingToken(){return this._httpClient.post("api/auth/sign-in-with-token",{accessToken:this.accessToken}).pipe(k(()=>a(!1)),f(t=>(t.accessToken&&(this.accessToken=t.accessToken),this._authenticated=!0,this._userService.user=t.user,a(!0))))}logoutSession(){return this._httpClient.post(this._appSettings.auth.url.baseOut,{})}signOut(){return localStorage.removeItem("accessToken"),this._authenticated=!1,a(!0)}signUp(t){return this._httpClient.post(this._appSettings.authTrabajador.url.base,t)}unlockSession(t){return this._httpClient.post("api/auth/unlock-session",t)}check(){return this._authenticated?a(!0):this.accessToken?l.isTokenExpired(this.accessToken)?a(!1):a(!0):a(!1)}};e.\u0275fac=function(s){return new(s||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();export{w as a,B as b};
